<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>4&nbsp; Autoregressive Moving Average (ARMA) Models â€“ Time Series Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./l05_arima.html" rel="next">
<link href="./l03_smoothing.html" rel="prev">
<link href="./tsar_fav.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./l04_arma.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Time Series Analysis</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/vlyubchich/tsar/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l01_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Review of Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l02_tsintro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Time Series Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l03_smoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Smoothing, Detrending, and Deseasonalizing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l04_arma.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l05_arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Autoregressive Integrated Moving Average (ARIMA) Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l06_garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generalized Autoregressive Conditional Heteroskedasticity (GARCH) Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l07_trendtest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Trend Detection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l08_tsreg1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Time Series Regression with Trends</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l09_tsreg2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time Series Regression with Correlated Errors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l12_forecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Model Evaluation and Forecasting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l13_spectral.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Spectral Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Software</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s1_wls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Weighted least squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s2_gls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Generalized least squares</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s4_trendsync.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Synchrony of parametric trends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s7_garma.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Generalized autoregressive moving average (GARMA) models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s_practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Practice exercises</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">4.1</span> Introduction</a></li>
  <li><a href="#autoregressive-ar-models" id="toc-autoregressive-ar-models" class="nav-link" data-scroll-target="#autoregressive-ar-models"><span class="header-section-number">4.2</span> Autoregressive (AR) models</a></li>
  <li><a href="#the-yulewold-representation-and-linear-processes" id="toc-the-yulewold-representation-and-linear-processes" class="nav-link" data-scroll-target="#the-yulewold-representation-and-linear-processes"><span class="header-section-number">4.3</span> The Yuleâ€“Wold representation and linear processes</a></li>
  <li><a href="#moving-average-ma-models" id="toc-moving-average-ma-models" class="nav-link" data-scroll-target="#moving-average-ma-models"><span class="header-section-number">4.4</span> Moving average (MA) models</a></li>
  <li><a href="#arma" id="toc-arma" class="nav-link" data-scroll-target="#arma"><span class="header-section-number">4.5</span> ARMA</a></li>
  <li><a href="#summary-of-armaarma-models" id="toc-summary-of-armaarma-models" class="nav-link" data-scroll-target="#summary-of-armaarma-models"><span class="header-section-number">4.6</span> Summary of AR/MA/ARMA models</a></li>
  <li>
<a href="#example-analysis" id="toc-example-analysis" class="nav-link" data-scroll-target="#example-analysis"><span class="header-section-number">4.7</span> Example analysis</a>
  <ul class="collapse">
<li><a href="#automatic-model-selection" id="toc-automatic-model-selection" class="nav-link" data-scroll-target="#automatic-model-selection"><span class="header-section-number">4.7.1</span> Automatic model selection</a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">4.8</span> Conclusion</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/vlyubchich/tsar/edit/master/l04_arma.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/vlyubchich/tsar/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>The goal of this lecture is to introduce a broad class of models for stationary time series â€“ autoregressive moving average (ARMA) models. You should recognize the difference between the AR and MA components and learn how to implement these models in practice.</p>
<p><strong>Objectives</strong></p>
<ol type="1">
<li>Define AR(<span class="math inline">\(p\)</span>), MA(<span class="math inline">\(q\)</span>), and ARMA(<span class="math inline">\(p,q\)</span>) models for stationary time series.</li>
<li>Identify the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> using ACF and PACF plots.</li>
<li>Estimate models using different methods and select a model using an information criterion (AIC or BIC).</li>
<li>Diagnose the residuals of an ARMA model.</li>
<li>Obtain forecasts from ARMA models.</li>
</ol>
<p><strong>Reading materials</strong></p>
<ul>
<li>Chapters 2, 3, and 5 in <span class="citation" data-cites="Brockwell:Davis:2002">Brockwell and Davis (<a href="references.html#ref-Brockwell:Davis:2002" role="doc-biblioref">2002</a>)</span>
</li>
</ul>
<section id="introduction" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">4.1</span> Introduction</h2>
<p>After removing or modeling a trend and strong seasonality in a time series, we need to take care of the stationary remainder, which may be autocorrelated or conditionally heteroskedastic. Here we introduce a broad class of ARMA models that deal with autocorrelation in time series.</p>
<p>Recall that a time series is (weakly) stationary if its mean and autocovariance do not depend on time, <span class="math inline">\(t\)</span>; autocovariance depends only on the lag <span class="math inline">\(h\)</span>. We will use these two conditions to show that the time series processes that we will model as AR, MA, or ARMA are stationary. Remember that the presence of autocorrelation does not mean that there is a trend.</p>
<p>We start by checking the two conditions for other typical univariate processes: white noise and random walk.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set seed for reproducible random number generation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> </span>
<span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">300L</span></span>
<span><span class="va">Lag</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Most of the examples in this lecture are simulated to show how sample autocorrelations may differ from theoretical ones, even if the simulated time series are sampled from a process of a certain type. All simulated series are of length 300.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example: Check the stationarity of white noise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(X_t\)</span> be a white noise series, <span class="math inline">\(X_t \sim \mathrm{WN}(0, \sigma^2)\)</span>. Show that <span class="math inline">\(X_t\)</span> is weakly stationary.</p>
<p><span class="math inline">\(\mathrm{E}(X_t) = 0\)</span> for all <span class="math inline">\(t\)</span> <span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{E}(X_t)\)</span> is independent of <span class="math inline">\(t\)</span>.</p>
<p>Now check the autocovariance <span class="math display">\[
\begin{align}
\mathrm{cov}(X_t, X_{t+h}) &amp;=
\begin{cases}
\mathrm{cov}(X_t, X_t) &amp; \text{if } h = 0\\
0                      &amp; \text{otherwise}
\end{cases} \\
&amp; =
\begin{cases}
\mathrm{var}(X_t) &amp; \text{if } h = 0\\
0                 &amp; \text{otherwise}
\end{cases} \\
&amp; =
\begin{cases}
\sigma^2 &amp; \text{if } h = 0\\
0        &amp; \text{otherwise}
\end{cases}
\end{align}
\]</span></p>
<p><span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{cov}(X_t, X_{t+h})\)</span> does not depend on <span class="math inline">\(t\)</span>, depends only on <span class="math inline">\(h\)</span>.</p>
<p>Both conditions of weak stationarity are satisfied, <span class="math inline">\(X_t\)</span> is weakly stationary.</p>
</div>
</div>
<p>See <a href="#fig-wn" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> with plots for <span class="math inline">\(X_t \sim \mathrm{WN}(0, \sigma^2)\)</span>, where <span class="math inline">\(\sigma = 2\)</span>. More specifically, <span id="eq-wn"><span class="math display">\[
X_t \sim \text{i.i.d.}\; N(0, \sigma^2);\; \sigma = 2.
\tag{4.1}\]</span></span></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Theoretical ACF, PACF</span></span>
<span><span class="va">RHO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample data</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="cn">T</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, ACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">ACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical ACF"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, PACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">PACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-wn" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-wn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-wn-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: White noise as specified in <a href="#eq-wn" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember that ACF(0) = PACF(0) = 1 always. Some R plotting functions show results for the zero lag (e.g., <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code>), some do not (e.g., <code><a href="https://rdrr.io/r/stats/acf.html">pacf()</a></code> and the function <code><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">forecast::ggAcf()</a></code> used here).</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example: Check the stationarity of random walk
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the stationarity of the random walk <span class="math inline">\(S_t\)</span>. <span class="math inline">\(S_t = \sum_{i=1}^t{X_t}\)</span>, where <span class="math inline">\(X_t \sim \text{i.i.d.}(0,\sigma^2)\)</span>, and <span class="math inline">\(S_0 = 0\)</span>.</p>
<p><span class="math inline">\(\mathrm{E}(S_t) = \mathrm{E}(\sum_{i=1}^t{X_t}) = 0\)</span> <span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{E}(X_t)\)</span> does not depend on <span class="math inline">\(t\)</span>.</p>
<p>Now check the autocovariance <span class="math display">\[
\begin{split}
\mathrm{cov}(S_t, S_{t+h}) &amp;= \mathrm{cov}(S_t, S_t + X_{t+1}+\dots + X_{t+h})\\
&amp; = \mathrm{cov}(S_t, S_t) + \mathrm{cov}(S_t, X_{t+1}+\dots + X_{t+h})\\
&amp; = \mathrm{var}(S_t) + 0\\
&amp; = \mathrm{var}\left(\sum_{i=1}^t{X_t}\right) \\
&amp; = \sum_{i=1}^t\mathrm{var}(X_t)\\
&amp; = t\sigma^2
\end{split}
\]</span></p>
<p>Autocovariance of <span class="math inline">\(S_t\)</span> depends on time, <span class="math inline">\(S_t\)</span> is not stationary. Also, notice that <span class="math inline">\(S_t = S_{t-1} + X_t\)</span>, that is, <span class="math inline">\(S_t\)</span> is a nonstationary AR(1) process with <span class="math inline">\(\phi_1 = 1\)</span>.</p>
</div>
</div>
<p>Random walk patterns are widely found in nature, for example, in the phenomenon of Brownian motion. Notice the slow linear decay in the ACF of nonstationary time series (<a href="#fig-rw" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>) <span id="eq-rw"><span class="math display">\[
S_t = \sum_{i = 1}^t X_i,
\tag{4.2}\]</span></span> where <span class="math inline">\(X_t \sim \mathrm{i.i.d.}(0, \sigma^2)\)</span> and <span class="math inline">\(\sigma = 2\)</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sample data</span></span>
<span><span class="va">RW0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">RW0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">RW0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">RW0</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-rw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-rw-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Zero-mean random walk as specified in <a href="#eq-rw" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>.
</figcaption></figure>
</div>
</div>
</div>
<p>Random walk may look very different if the i.i.d. process has a non-zero mean. Here is a random walk with drift (<a href="#fig-rw2" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>): <span id="eq-rw2"><span class="math display">\[
S_t = \sum_{i = 1}^t X_i,
\tag{4.3}\]</span></span> where <span class="math inline">\(X_t \sim \mathrm{i.i.d.}(a, \sigma^2)\)</span>, <span class="math inline">\(a = 0.2\)</span>, and <span class="math inline">\(\sigma = 2\)</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sample data</span></span>
<span><span class="va">RW2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">X</span> <span class="op">+</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">RW2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">RW2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">RW2</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-rw2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-rw2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-rw2-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rw2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Random walk with drift as specified in <a href="#eq-rw2" class="quarto-xref">Equation&nbsp;<span>4.3</span></a>.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="autoregressive-ar-models" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="autoregressive-ar-models">
<span class="header-section-number">4.2</span> Autoregressive (AR) models</h2>
<p><strong>AR(1) model</strong></p>
<p>We are already familiar with an AR(1) model <span class="math display">\[
Y_{t} = \phi_{1}  Y_{t -1} + \epsilon_{t},
\]</span> where</p>
<ul>
<li>
<span class="math inline">\(\epsilon_{t}\)</span> is white noise (<span class="math inline">\(\mathrm{E}(\epsilon_{t}) = 0\)</span> and <span class="math inline">\(\mathrm{E}(\epsilon_{t}^2) = \sigma^{2}_{\epsilon}\)</span>),</li>
<li>
<span class="math inline">\(\epsilon_{t}\)</span> is independent of <span class="math inline">\(Y_{t - k}, \dots, Y_{t - 1}\)</span>,</li>
<li>
<span class="math inline">\(\phi_{1}\)</span> is the coefficient of autoregression.</li>
</ul>
<p>The AR(1) model can be rewritten as <span class="math display">\[
(1 - \phi_{1} B) Y_{t} = \epsilon_{t},
\]</span> or in even more compact notation as <span class="math display">\[
\phi(B)Y_t = \epsilon_t,
\]</span> where <span class="math inline">\(\phi(\lambda)\)</span> is the polynomial <span class="math inline">\(\phi (\lambda) = 1 - \phi_{1} \lambda\)</span>.</p>
<p>Let us find the variance of <span class="math inline">\(Y_{t}\)</span> <span class="math display">\[
\begin{split}
\mathrm{var} (Y_{t} ) = \mathrm{E} ( \phi_{1} Y_{t - 1} + \epsilon_{t})^{2} &amp; =  \mathrm{E} ( \phi^{2}_{1} Y^{2}_{t - 1} + 2 \phi_{1} Y_{t-1}  \epsilon_{t} + \epsilon^{2}_{ t}) \\
\\
&amp; = \phi^{2}_{1} \mathrm{E}(Y^{2}_{t - 1}) + 2\phi_{1} \mathrm{E} (Y_{t - 1} \epsilon_{t}) + \mathrm{E}(\epsilon^{2}_{t}) \\
\\
&amp; = \phi^{2}_{1} \mathrm{var} \left( Y_{t -1} \right) + 0 + \sigma^{2}_{\epsilon} \\
\\
&amp; = \phi^{2}_{1} \mathrm{var} \left( Y_{t -1} \right) + \sigma^{2}_{\epsilon}.
\end{split}
\]</span></p>
<p>Hence, if <span class="math inline">\(\phi_{1} \neq \pm 1\)</span>, then <span id="eq-ar1var"><span class="math display">\[
\sigma^{2}_{Y} = \frac{\sigma^{2}_{\epsilon}} {1 - \phi^{2}_{1}}.
\tag{4.4}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For <a href="#eq-ar1var" class="quarto-xref">Equation&nbsp;<span>4.4</span></a> to make sense, we require <span class="math inline">\(|\phi_{1}| &lt; 1\)</span>. This is the condition under which AR(1) process is (<em>weakly</em>) <em>stationary</em>. E.g., if <span class="math inline">\(\phi_{1} = \pm 1\)</span> then the process is a random walk and is also not stationary. We shall see later that all AR processes require some condition of this nature.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example: Check the stationarity of AR(1)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check that the AR(1) process <span class="math inline">\(Y_t\)</span> is stationary, given that <span class="math inline">\(Y_t = \phi Y_{t-1} + \epsilon_t\)</span>, <span class="math inline">\(|\phi| &lt; 1\)</span>, and <span class="math inline">\(\epsilon_t \sim \mathrm{WN}(0, \sigma^2)\)</span>.</p>
<p><span class="math display">\[
\begin{split}
\mathrm{E}(Y_t) &amp;= \mathrm{E}(\phi Y_{t-1} + \epsilon_t)\\
&amp; = \phi \mathrm{E}(Y_{t-1}) + \mathrm{E}(\epsilon_t)\\
&amp; = \phi^2 \mathrm{E}(Y_{t-2}) + 0\\
&amp; = \phi^3 \mathrm{E}(Y_{t-3})\\
&amp; = \dots\\
&amp; = \phi^N \mathrm{E}(Y_{t-N})\\
\lim_{N \rightarrow \infty} \mathrm{E}(Y_t) &amp;= \lim_{N \rightarrow \infty} \phi^N \mathrm{E}(Y_{t-N}) = 0
\end{split}
\]</span> Therefore, the mean of <span class="math inline">\(Y_t\)</span> does not depend on time.</p>
<p>Now check the autocovariance. For <span class="math inline">\(h=0\)</span>, <span class="math inline">\(\mathrm{cov}(Y_t, Y_{t}) = \mathrm{var}(Y_t) = \sigma^2_Y\)</span>, which is derived in <a href="#eq-ar1var" class="quarto-xref">Equation&nbsp;<span>4.4</span></a> and does not depend on time.</p>
<p>For <span class="math inline">\(h \neq 0\)</span>, <span class="math display">\[
\begin{split}
\mathrm{cov}(Y_t, Y_{t-h}) &amp;= \mathrm{cov}(\phi Y_{t-1} + \epsilon_t, Y_{t-h})\\
&amp; = \mathrm{cov}(\phi Y_{t-1}, Y_{t-h}) + \mathrm{cov}(\epsilon_t, Y_{t-h})\\
&amp; = \phi \mathrm{cov}(Y_{t-1}, Y_{t-h}) + 0\\
&amp; = \phi \mathrm{cov}(\phi Y_{t-2} + \epsilon_{t-1}, Y_{t-h})\\
&amp; = \phi^2 \gamma_Y(h-2)\\
&amp; = \dots\\
&amp; = \phi^h \gamma_Y(0) \\
&amp; = \phi^h \sigma_Y^2,
\end{split}
\]</span> thus the autocovariance does not depend on time, depends only on lag <span class="math inline">\(h\)</span>.</p>
<p>Both conditions for weak stationarity are satisfied, the <span class="math inline">\(Y_t\)</span> specified above is weakly stationary.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Additionally, see that the ACF of the AR(1) process <span id="eq-arACF"><span class="math display">\[
\rho_Y(h) = \frac{\gamma_Y(h)}{\gamma_Y(0)} = \frac{\phi^h \gamma_Y(0)}{\gamma_Y(0)} = \phi^h
\tag{4.5}\]</span></span> shows exponential decay. Remember this about AR processes.</p>
</div>
</div>
<p><strong>AR(<span class="math inline">\(p\)</span>) model</strong></p>
<p>Now we can extend our AR(1) model to <span id="eq-ARp"><span class="math display">\[
\begin{split}
Y_{t} &amp;= \phi_{1} Y_{t  - 1} + \phi_{2} Y_{t - 2} + \dots + \phi_{p} Y_{t - p} + \epsilon_{t} \\
&amp;=\sum_{i=1}^p\phi_iY_{t-i} + \epsilon_t
\end{split}
\tag{4.6}\]</span></span> with <span class="math inline">\(\epsilon_{t}\)</span> independent of <span class="math inline">\(Y_{t - k}, \dots , Y_{t - 1}\)</span>; <span class="math inline">\(p \in \mathbb{N}^{+}\)</span>. This model is called <em>an autoregressive model of order</em> <span class="math inline">\(p\)</span>, or simply <em>an AR(<span class="math inline">\(p\)</span>) model</em>.</p>
<p>Similarly to AR(1), every AR(<span class="math inline">\(p\)</span>) model may be rewritten as <span class="math display">\[
\left(1 -  \sum^{p}_{i = 1} \phi_{i} B^{i} \right) Y_{t} = \epsilon_{t},
\]</span> or in more compact notation as <span class="math display">\[
\phi (B) Y_t = \epsilon_t,
\]</span> where <span class="math inline">\(\phi(\lambda)\)</span> is the polynomial <span class="math inline">\(\phi(\lambda) = 1 - \phi_{1} \lambda - \phi_{2} \lambda^{2} - \dots - \phi_{p} \lambda^{p}\)</span>.</p>
<p>The stationarity condition for AR(<span class="math inline">\(p\)</span>) model is defined through the polynomial <span class="math inline">\(\phi(\lambda)\)</span>. Specifically, <em>all the roots of the function <span class="math inline">\(\phi(\lambda)\)</span> lie outside the unit circle in the complex plane</em>.</p>
<p><strong>ACF of AR processes</strong></p>
<p>To compute ACVF and ACF for the AR(<span class="math inline">\(p\)</span>) model, multiplying both sides of <a href="#eq-ARp" class="quarto-xref">Equation&nbsp;<span>4.6</span></a> by <span class="math inline">\(Y_{t - k}\)</span> for <span class="math inline">\(k \geqslant p\)</span> and taking expectations yields <span class="math display">\[
\begin{split}
\mathrm{E} \left( Y_{t} Y_{t - k} \right) &amp; =  \mathrm{E} \left( \phi_{1} Y_{t-1} Y_{t-k} + \phi_{2} Y_{t-2} Y_{t-k} + \dots + \phi_{p} Y_{t -p} Y_{t - k} + \epsilon_{t} Y_{t -k} \right) \\
&amp; =  \phi_{1}  \mathrm{E} \left( Y_{t  - 1} Y_{t - k} \right) + \phi_{2} \mathrm{E} \left( Y_{t - 2} Y_{t - k} \right) + \dots+ \phi_{p} \mathrm{E} \left(Y_{t - p} Y_{t - k} \right) + \mathrm{E} \left( \epsilon_{t} Y_{t  - k} \right).
\end{split}
\]</span></p>
<p>Thus, we get autocovariances <span class="math display">\[
\gamma(k) = \phi_{1}\gamma(k -1) + \phi_{2}\gamma(k - 2) + \dots + \phi_{p} \gamma(k  - p),
\]</span> which turns into a <em>mixed exponential decay of order</em> <span class="math inline">\(p\)</span> for the ACF <span class="math display">\[
\rho(k) = \phi_{1} \rho(k - 1) + \phi_{2} \rho(k - 2) + \dots + \phi_{p} \rho(k - p).
\]</span></p>
<p>To identify the decay, we need the <span class="math inline">\(p\)</span> starting correlations <span class="math inline">\(\rho(1), \rho(2), \dots, \rho(p)\)</span>, which we can find from the parameters <span class="math inline">\(\phi_{1}, \phi_{2}, \dots, \phi_{p}\)</span>.</p>
<p><strong>PACF of AR processes</strong></p>
<p>An AR(<span class="math inline">\(p\)</span>) model implies <span class="math inline">\(Y_{t+h} = \sum_{i=1}^p\phi_{i} Y_{t + h - i} + \epsilon_{t+h}\)</span>, where the roots of <span class="math inline">\(\phi(\lambda)\)</span> are outside the unit circle. When <span class="math inline">\(h &gt; p\)</span>, the regression of <span class="math inline">\(Y_{t+h}\)</span> on <span class="math inline">\(\{ Y_{t+1}, \dots, Y_{t+h-1}\}\)</span> is <span class="math display">\[
\hat{Y}_{t+h} = \sum^p_{i=1} \phi_i Y_{t+h-i}.
\]</span> Thus, when <span class="math inline">\(h &gt; p\)</span>, <span class="math display">\[
\begin{align}
\rho_{hh} &amp;= \mathrm{cor}(Y_{t+h}-\hat{Y}_{t+h}, Y_t - \hat{Y}_t) \\
&amp; = \mathrm{cor}(\epsilon_{t+h}, Y_t - \hat{Y}_t) \\
&amp; = 0,
\end{align}
\]</span> because, by the causality of the process, the difference <span class="math inline">\(Y_t - \hat{Y}_t\)</span> depends only on <span class="math inline">\(\{ \epsilon_{t+h-1}, \epsilon_{t+h-2},\dots \}\)</span>.</p>
<p>When <span class="math inline">\(h\leqslant p\)</span>, <span class="math inline">\(\rho_{hh}\)</span> is not zero, and <span class="math inline">\(\rho_{11}, \dots, \rho_{p-1,p-1}\)</span> are not necessarily zero.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The important conclusion is that the PACF of an AR(<span class="math inline">\(p\)</span>) process necessarily cuts off (PACF = 0) after lag <span class="math inline">\(p\)</span>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example: PACF of AR(1) process
</div>
</div>
<div class="callout-body-container callout-body">
<p>For an AR(1) process, the best linear predictor <span class="math inline">\(P(X_{n + 1} | X_n) = \phi X_n\)</span>.</p>
<p>For <span class="math inline">\(h = 0\)</span>, <span class="math inline">\(\rho_{00} = 1\)</span>.<br>
For <span class="math inline">\(h = 1\)</span>, <span class="math inline">\(\rho_{11} = \mathrm{cor}(X_t, X_{t+1}) = \phi\)</span> (no intermediate lags, see <a href="#eq-arACF" class="quarto-xref">Equation&nbsp;<span>4.5</span></a>).<br>
For <span class="math inline">\(h = 2\)</span>, note that <span class="math inline">\(X_{t+2} = \phi X_{t+1} + \epsilon_{t+2}\)</span>, then <span class="math display">\[
\begin{align}
\rho_{22} &amp;= \mathrm{cor}(X_t - P(X_t | X_{t+1}), X_{t+2} - P(X_{t+2} | X_{t+1})) \\
&amp;= \mathrm{cor}(X_t - P(X_t | X_{t+1}), X_{t+2} - \phi X_{t+1})\\
&amp;= \mathrm{cor}(X_t - P(X_t | X_{t+1}), \epsilon_{t+2})\\
&amp;= 0
\end{align}
\]</span> because the term <span class="math inline">\(X_t - P(X_t | X_{t+1})\)</span> is a function of <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+1}\)</span> only, while <span class="math inline">\(\epsilon_{t+2}\)</span> is the future noise.</p>
<p>Thus, for <span class="math inline">\(X_t \sim\)</span> AR(1), the PACF <span class="math display">\[
\rho_{hh} =
\begin{cases}
1 &amp; \text{if } h = 0\\
\phi &amp; \text{if } h = 1\\
0 &amp; \text{if } h \geqslant 2
\end{cases}
\]</span></p>
</div>
</div>
<p>See the plots for the following AR(1) process in <a href="#fig-ar1" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>: <span id="eq-ar1"><span class="math display">\[
X_t = \phi_1 X_{t-1} + \epsilon_t,
\tag{4.7}\]</span></span> where <span class="math inline">\(\epsilon_t \sim N(0,\sigma^2)\)</span>, <span class="math inline">\(\phi_1=0.6\)</span>, and <span class="math inline">\(\sigma = 1\)</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Theoretical ACF, PACF</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">0.6</span></span>
<span><span class="va">RHO</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">^</span><span class="va">Lag</span></span>
<span><span class="va">ALPHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">phi</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample data</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html">arima.sim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, ar <span class="op">=</span> <span class="va">phi</span><span class="op">)</span>, n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, ACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">ACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical ACF"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, PACF <span class="op">=</span> <span class="va">ALPHA</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">PACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-ar1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ar1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-ar1-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ar1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: AR(1) process as specified in <a href="#eq-ar1" class="quarto-xref">Equation&nbsp;<span>4.7</span></a>.
</figcaption></figure>
</div>
</div>
</div>
<p>See the plots for the following AR(1) process in <a href="#fig-ar2" class="quarto-xref">Figure&nbsp;<span>4.5</span></a> (only the coefficient <span class="math inline">\(\phi_1\)</span> changed from the previous specification): <span id="eq-ar2"><span class="math display">\[
X_t = \phi_1 X_{t-1} + \epsilon_t;\; \epsilon_t \sim N(0,\sigma^2);\; \phi_1=-0.6,\; \sigma = 1.
\tag{4.8}\]</span></span></p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Theoretical ACF, PACF</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.6</span></span>
<span><span class="va">RHO</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">^</span><span class="va">Lag</span></span>
<span><span class="va">ALPHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">phi</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample data</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html">arima.sim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, ar <span class="op">=</span> <span class="va">phi</span><span class="op">)</span>, n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, ACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">ACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical ACF"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, PACF <span class="op">=</span> <span class="va">ALPHA</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">PACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-ar2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ar2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-ar2-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ar2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: AR(1) process as specified in <a href="#eq-ar2" class="quarto-xref">Equation&nbsp;<span>4.8</span></a>.
</figcaption></figure>
</div>
</div>
</div>
<p>ACF of the AR(1) model takes two graphical forms depending on whether the coefficient <span class="math inline">\(\phi_{1}\)</span> is positive or negative. In the first case, the decay occurs through the positive axis only (<a href="#fig-ar1" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>). In the second case, the decay alternates between the negative and positive axes (<a href="#fig-ar2" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>). This is so-called <em>mixed exponential decay</em>. Although both forms are examples of exponential decay, they appear different visually.</p>
<p>As the order <span class="math inline">\(p\)</span> of an AR(<span class="math inline">\(p\)</span>) model increases, the number of different visual presentations of the ACF increases as well. The ACF of an AR(<span class="math inline">\(p\)</span>) model can take <span class="math inline">\(2^{p}\)</span> different graphical forms, depending on the signs (positive or negative) of the parameters <span class="math inline">\(\phi_{1}, \phi_{2}, \dots, \phi_{p}\)</span>. Thus, the ACF of an AR(2) model can take <span class="math inline">\(2^{2} = 4\)</span> different graphical forms.</p>
</section><section id="the-yulewold-representation-and-linear-processes" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="the-yulewold-representation-and-linear-processes">
<span class="header-section-number">4.3</span> The Yuleâ€“Wold representation and linear processes</h2>
<p>A process <span class="math inline">\(X_{t}\)</span>, (<span class="math inline">\(t = 0, \pm 1, \pm 2, \dots\)</span>) is said to be linear if it has a representation of the form <span class="math display">\[
X_{t} = \mu + \sum^{\infty}_{r = - \infty} c_{r} \epsilon_{t - r},
\]</span> where <span class="math inline">\(\mu\)</span> is a common mean, <span class="math inline">\(c_{r}\)</span> is a sequence of fixed constants, and <span class="math inline">\(\epsilon_{t}\)</span> are uncorrelated random variables with mean 0 and common variance.</p>
<p>We assume <span class="math inline">\(\sum c^{2}_{r} &lt; \infty\)</span> to ensure that the variances of the individual <span class="math inline">\(X_{t}\)</span> are finite (stationarity and existence condition). Then the process <span class="math inline">\(X_{t}\)</span> is necessarily (weakly) stationary.</p>
<p>If we also require that <span class="math inline">\(\epsilon_{t}\)</span> are identically distributed, then <span class="math inline">\(X_{t}\)</span> is strictly stationary. For example, see the case of normally distributed <span class="math inline">\(\epsilon_{t}\)</span>.</p>
<p>If <span class="math inline">\(c_r = 0\)</span> for all <span class="math inline">\(r &lt; 0\)</span>, <span class="math inline">\(X_t\)</span> is called <em>causal</em> (i.e., the process at the time <span class="math inline">\(t\)</span> does not depend on the future, yet unobserved, values of <span class="math inline">\(\epsilon_{t}\)</span>).</p>
<p>The representation of a causal stationary process (depending only on the past) <span class="math inline">\(X_{t}\)</span> with zero mean in the form <span id="eq-YuleWald"><span class="math display">\[
X_{t} = \sum^{\infty}_{r = 0} c_{r} \epsilon_{t - r},
\tag{4.9}\]</span></span> where <span class="math inline">\(\epsilon_{t} \sim \mathrm{WN}(0, \sigma^{2}\)</span>) and <span class="math inline">\(\sum c^{2}_{r} &lt; \infty\)</span>, is sometimes called <em>the Yuleâ€“Wald representation</em>.</p>
</section><section id="moving-average-ma-models" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="moving-average-ma-models">
<span class="header-section-number">4.4</span> Moving average (MA) models</h2>
<p><strong>MA(1) model</strong></p>
<p>A zero mean stationary process <span class="math inline">\(Y_{t}\)</span> is called a moving average process of order 1, or <em>an MA(1) model</em>, if <span class="math inline">\(Y_{t}\)</span> satisfies <span class="math display">\[
Y_{t} = \epsilon_{t} + \theta_{1}  \epsilon_{t - 1},
\]</span> where <span class="math inline">\(\epsilon_{t}\)</span> is white noise.</p>
<p>In other words, an MA(1) process has <span class="math inline">\(c_{r} = 0\)</span> for every <span class="math inline">\(r &gt; 1\)</span> in its Yuleâ€“Wold representation <a href="#eq-YuleWald" class="quarto-xref">Equation&nbsp;<span>4.9</span></a>.</p>
<p>The MA(1) model may be rewritten as <span class="math display">\[
Y_{t} = (1 + \theta_{1} B) \epsilon_{t},
\]</span> or in the compact form <span class="math display">\[
Y_t = \theta (B) \epsilon_t,
\]</span> where <span class="math inline">\(\theta (\lambda)\)</span> is the polynomial <span class="math inline">\(\theta(\lambda) = 1 + \theta_{1} \lambda\)</span>.</p>
<p><strong>MA(q) model</strong></p>
<p>We can extend MA(1) model further and consider <span class="math display">\[
\begin{split}
Y_{t} &amp;= \epsilon_{t} + \theta_{1} \epsilon_{t -1} + \theta_{2} \epsilon_{t - 2} + \dots + \theta_{q} \epsilon_{t - q} \\
&amp;= \epsilon_{t} + \sum_{i=1}^q \theta_i \epsilon_{t-i}.
\end{split}
\]</span> This model is called a <em>moving average model of order <span class="math inline">\(q\)</span></em>, or a MA(<span class="math inline">\(q\)</span>).</p>
<p>We can write down MA(<span class="math inline">\(q\)</span>) as <span class="math display">\[
Y_{t} = \left(1 + \theta_{1} B + \theta_{2} B^{2} + \dots + \theta_{q} B^{q} \right) \epsilon_{t} ,
\]</span> or in the compact form <span class="math display">\[
Y_t = \theta (B) \epsilon_t,
\]</span> where <span class="math inline">\(\theta(\lambda)\)</span> is the polynomial <span class="math inline">\(\theta(\lambda) = 1 + \theta_{1} \lambda + \theta_{2} \lambda^{2} + \dots + \theta_{q} \lambda^{q}\)</span>.</p>
<p>Now compute the ACVF and ACF of the MA(<span class="math inline">\(q\)</span>) process <span class="math inline">\(Y_{t}\)</span>. Using the Yuleâ€“Wald representation of <span class="math inline">\(Y_{t}\)</span>, <span class="math display">\[
Y_{t} = \sum^{q}_{r = 0} \theta_{r} \epsilon_{t - r},
\]</span> the autocovariance <span class="math display">\[
\begin{split}
\gamma_Y(h) &amp; = \mathrm{cov}(Y_{t}, Y_{t+h}) = \mathrm{cov} \left( \sum^{q}_{r = 0} \theta_{r }\epsilon_{t - r}, \sum^{q}_{\ell = 0} \theta_{\ell} \epsilon_{t + h - \ell} \right) \\
\\
&amp; = \sum^{q}_{r = 0} \sum^{q}_{\ell = 0} \mathrm{cov} \left( \theta_{r } \epsilon_{t - r},  \theta_{\ell} \epsilon_{t + h - \ell} \right) \\
\\
&amp; = \sum^{q}_{r = 0} \sum^{q}_{\ell = 0} \theta_{r } \theta_{\ell} \mathrm{cov}  \left( \epsilon_{t - r}, \epsilon_{t - r}  \right) ~~ \text{since cov} \left( \epsilon_{u}, \epsilon_{v}  \right) = 0 ~ \text{unless} ~ u = v \\
\\
&amp; = \sigma_{\epsilon}^{2} \sum^{q}_{r = 0} \theta_{r} \theta_{r+h}.
\end{split}
\]</span> Note that the case of no time shift between the noise series, i.e., when <span class="math inline">\(t-r = t+h-l\)</span>, leads to <span class="math inline">\(l=r+h\)</span>, which is used in the last row.</p>
<p>Hence, <span id="eq-MAacvf"><span class="math display">\[
\gamma_Y(h) = \left\{
\begin{array}{lcl}
\sigma_{\epsilon}^{2} \sum^{q  - h}_{r = 0} \theta_{r} \theta_{r+h} &amp; \text{for} &amp;  h \leqslant q;\\
0 &amp; \text{for} &amp; h &gt; q.
\end{array}
\right.
\tag{4.10}\]</span></span></p>
<p>This leads us to the most important result about the correlation structure for MA(<span class="math inline">\(q\)</span>) processes. For an MA(<span class="math inline">\(q\)</span>) process, <span class="math inline">\(\gamma(h) = 0\)</span> for all <span class="math inline">\(h &gt; q\)</span>. Equivalently, the ACF has <span class="math inline">\(q\)</span> â€˜startingâ€™ correlations or spikes, <span class="math inline">\(\rho(1), \rho(2), \dots, \rho(q)\)</span>, and then <span class="math inline">\(\rho(h) = 0\)</span> for <span class="math inline">\(h &gt; q\)</span>. We say that the ACF â€˜cuts offâ€™ after the lag <span class="math inline">\(q\)</span>.</p>
<p>Now compute the actual values of the starting correlations <span class="math inline">\(\rho(1), \dots, \rho(q)\)</span> in terms of the parameters <span class="math inline">\(\theta_{0} = 1, \theta_{1}, \theta_{2}, \dots, \theta_{q}\)</span>. Using <a href="#eq-MAacvf" class="quarto-xref">Equation&nbsp;<span>4.10</span></a>, we get</p>
<ul>
<li>
<p>For the MA(1) model <span class="math inline">\(q = 1\)</span>. Hence <span class="math display">\[
\begin{split}
h  =  0 &amp;\rightarrow \gamma(0) = \sigma^{2} \sum^{1}_{ r=0}  \theta^{2}_{r} = \sigma^{2} \left( \theta^{2}_{0} + \theta^{2}_{1} \right) = \sigma^{2} \left(1 + \theta^{2}_{1}\right). \\
\\
h  =  1 &amp;\rightarrow \gamma(1) = \sigma^{2}  \sum^{0}_{ r=0}  \theta_{r} \theta_{r + 1} = \sigma^{2} \theta_{0} \theta_{1} = \sigma^{2} \theta_{1}.
\end{split}
\]</span></p>
<p>Therefore <span class="math inline">\(\rho(1) = \gamma(1) / \gamma(0) = \theta_{1} / (1 + \theta^{2}_{1})\)</span>.</p>
</li>
<li><p>For the MA(2) model <span class="math inline">\(q = 2\)</span>. Hence <span class="math display">\[
\begin{split}
h =  0 &amp;\rightarrow \gamma(0) = \sigma^{2} \sum^{2}_{r=0}  \theta^{2}_{r} = \sigma^{2} \left(1 + \theta^{2}_{1} + \theta^{2}_{2}\right). \\
\\
h  =  1 &amp;\rightarrow \gamma(1) = \sigma^{2} \sum^{1}_{r=0}  \theta_{r} \theta_{r + 1} = \sigma^{2} \left(\theta_{1} + \theta_{1} \theta_{2} \right) = \sigma^{2} \theta_{1}  \left(1 + \theta_{2}\right). \\
\\
h  =  2 &amp;\rightarrow \gamma(2) = \sigma^{2} \sum^{0}_{r=0}  \theta_{r} \theta_{r + 2} = \sigma^{2} \theta_{2}.
\end{split}
\]</span> Therefore <span class="math inline">\(\rho(1) = \frac{\gamma(1)}{\gamma(0)} = \frac{\theta_{1} \left(1 + \theta_{2} \right)}{1+ \theta^{2}_{1} + \theta^{2}_{2}}\)</span> and <span class="math inline">\(\rho(2) = \frac{\gamma(2)}{\gamma(0)} = \frac{\theta_{2}}{1+ \theta^{2}_{1} + \theta^{2}_{2}}\)</span>.</p></li>
<li><p>Proceed analogously for the MA(<span class="math inline">\(q\)</span>) model.</p></li>
</ul>
<p>Another method of obtaining the correlation coefficients of the MA(<span class="math inline">\(q\)</span>) is to derive the covariance <span class="math inline">\(\gamma(h) = \mathrm{cov} (Y_{t}, Y_{t - h} )\)</span> directly by using the bilinear properties of covariance and determining the interaction between the white noise terms. The advantage of this method is that we do not have to memorize anything. Moreover, since white noise has the property that <span class="math inline">\(\mathrm{cov} (\epsilon_{u}, \epsilon_{v}) = 0\)</span> whenever <span class="math inline">\(u \neq v\)</span>, interactions occur only when the time indices match up, i.e., only when <span class="math inline">\(u = v\)</span>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Example: ACVF and ACF of MA(1)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider an MA(1) model. Let <span class="math inline">\(h \geqslant 0\)</span>. Applying the covariance properties we obtain the general expression: <span class="math display">\[
\begin{split}
\gamma(h) &amp; = \mathrm{cov}\left( Y_{t}, Y_{t - h} \right) \\
&amp; = \mathrm{cov} \left( \epsilon_{t} + \theta_{1} \epsilon_{t - 1},\; \epsilon_{t - h} + \theta_{1} \epsilon_{t - h - 1}  \right) \\
&amp; =  \mathrm{cov} \left( \epsilon_{t},  \epsilon_{t - h} \right) + \theta_{1} \mathrm{cov} \left(  \epsilon_{t},  \epsilon_{t - h - 1}  \right) + \theta_{1} \mathrm{cov} \left( \epsilon_{t - 1}, \epsilon_{t - h} \right) + \theta^{2}_{1} \mathrm{cov} \left(\epsilon_{t - 1}, \epsilon_{t - h - 1} \right).
\end{split}
\]</span></p>
<p>Note that the covariances in the last line of the above expression will be nonzero if the time indices match up. By plugging different values of <span class="math inline">\(h\)</span> into the above equation, we obtain <span class="math display">\[
\begin{align}
h  =  0 \rightarrow \gamma(0) &amp;= \mathrm{cov} \left( \epsilon_{t}, \epsilon_{t} \right) + 0 + 0 + \theta^{2}_{1} \mathrm{cov} \left( \epsilon_{t - 1}, \epsilon_{t - 1} \right) \\
&amp;= \sigma^{2} + \theta^{2}_{1} \sigma^{2} \\
&amp;= \sigma^{2} \left( 1 + \theta^{2}_{1} \right). \\
\\
h = 1 \rightarrow \gamma(1) &amp;= 0 + 0 + \theta_{1} \mathrm{cov} \left( \epsilon_{t - 1}, \epsilon_{t - 1} \right) + 0 \\
&amp;= \sigma^{2} \theta_{1}.\\
\\
h \geqslant 2 \rightarrow \gamma(h) &amp;= 0 + 0 + 0 + 0 \\
&amp;= 0.
\end{align}
\]</span></p>
<p>This method generalizes easily to computing autocovariances for MA(<span class="math inline">\(q\)</span>) models of higher orders.</p>
<p>Recall that ACF is the ACVF standardized by the variance (which is the ACVF at lag zero), hence the ACF <span class="math display">\[
\begin{align}
\rho(h) &amp;= \frac{\gamma(h)}{\gamma(0)} \\
&amp;=
\begin{cases}
1 &amp; \text{if } h = 0 \\
\frac{\theta_1}{1 + \theta^2_1} &amp; \text{if } h = 1 \\
0 &amp; \text{if } h &gt; 1
\end{cases}
\end{align}
\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have explicitly determined the structure of the ACF of an MA(<span class="math inline">\(q\)</span>) process. Its most important feature is that <span class="math inline">\(\rho(h) = 0\)</span> for <span class="math inline">\(h &gt; q\)</span>. Remember this about MA processes.</p>
</div>
</div>
<p>Finer features, such as expressing the <span class="math inline">\(\rho(h)\)</span> in terms of the <span class="math inline">\(\theta_{r}\)</span> coefficients, can be determined as above.</p>
<p><strong>PACF of MA processes</strong></p>
<p>For an MA(<span class="math inline">\(q\)</span>), we can write <span class="math inline">\(Y_t = -\sum_{j=1}^{\infty} \pi_j Y_{t-j} + \epsilon_t\)</span>. Moreover, no finite representation exists. From this result, it should be apparent that the PACF will never cut off, as in the case of an AR(<span class="math inline">\(p\)</span>). For an MA(1), <span class="math inline">\(Y_t = \epsilon_t +\theta \epsilon_{t-1}\)</span>, with <span class="math inline">\(|\theta| &lt; 1\)</span>, it can be shown that <span class="citation" data-cites="Shumway:Stoffer:2014">(<a href="references.html#ref-Shumway:Stoffer:2014" role="doc-biblioref">Shumway and Stoffer 2014</a>)</span>: <span class="math display">\[
\rho_{hh} = - \frac{(-\theta)^h (1 - \theta^2)}{1 - \theta^{2(h+1)}}, \; h \geqslant 1.
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every MA(<span class="math inline">\(q\)</span>) process has an infinite autoregressive expansion and its PACF never cuts off. In fact, it can be shown that the PACF of an MA(<span class="math inline">\(q\)</span>) process damps out according to a mixed exponential decay of order <span class="math inline">\(q\)</span>.</p>
</div>
</div>
<p>We do not have to compute the PACF by performing numerous regressions first. The computations are done via a recursive formula.</p>
<p>Similar to AR(1) examples above, now consider two sets of plots for MA(1) processes with a positive and negative coefficient. For the MA(1) process <span id="eq-ma1"><span class="math display">\[
X_t = \theta_1 \epsilon_{t-1} + \epsilon_t,
\tag{4.11}\]</span></span> where <span class="math inline">\(\epsilon_t \sim N(0,\sigma^2)\)</span>, <span class="math inline">\(\theta_1=0.3\)</span>, and <span class="math inline">\(\sigma = 1\)</span>, see plots in <a href="#fig-ma1" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Theoretical ACF, PACF</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">RHO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">theta</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">theta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ALPHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/ARMAacf.html">ARMAacf</a></span><span class="op">(</span>ma <span class="op">=</span> <span class="va">theta</span>, lag.max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span>, pacf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample data</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html">arima.sim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ma <span class="op">=</span> <span class="va">theta</span><span class="op">)</span>, n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, ACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">ACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical ACF"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, PACF <span class="op">=</span> <span class="va">ALPHA</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">PACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-ma1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ma1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-ma1-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ma1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6: MA(1) as specified in <a href="#eq-ma1" class="quarto-xref">Equation&nbsp;<span>4.11</span></a>.
</figcaption></figure>
</div>
</div>
</div>
<p>For the MA(1) process with negative <span class="math inline">\(\theta_1\)</span>, <span id="eq-ma2"><span class="math display">\[
X_t = \theta_1 \epsilon_{t-1} + \epsilon_t,
\tag{4.12}\]</span></span> where <span class="math inline">\(\epsilon_t \sim N(0,\sigma^2)\)</span>, <span class="math inline">\(\theta_1=-0.3\)</span>, and <span class="math inline">\(\sigma = 1\)</span>, see plots in <a href="#fig-ma2" class="quarto-xref">Figure&nbsp;<span>4.7</span></a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Theoretical ACF, PACF</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.3</span></span>
<span><span class="va">RHO</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">theta</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">theta</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ALPHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/ARMAacf.html">ARMAacf</a></span><span class="op">(</span>ma <span class="op">=</span> <span class="va">theta</span>, lag.max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Lag</span><span class="op">)</span>, pacf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample data</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html">arima.sim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ma <span class="op">=</span> <span class="va">theta</span><span class="op">)</span>, n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, ACF <span class="op">=</span> <span class="va">RHO</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">ACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical ACF"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">Lag</span>, PACF <span class="op">=</span> <span class="va">ALPHA</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lag</span>, y <span class="op">=</span> <span class="va">PACF</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Theoretical PACF"</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample time series"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample ACF"</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">X</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Sample PACF"</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fu">plot_spacer</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">p3</span> <span class="op">+</span> <span class="va">p4</span> <span class="op">+</span> <span class="va">p5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-ma2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ma2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-ma2-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ma2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7: MA(1) as specified in <a href="#eq-ma2" class="quarto-xref">Equation&nbsp;<span>4.12</span></a>.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="arma" class="level2" data-number="4.5"><h2 data-number="4.5" class="anchored" data-anchor-id="arma">
<span class="header-section-number">4.5</span> ARMA</h2>
<p>An ARMA(<span class="math inline">\(p, q\)</span>) is a mixture of <span class="math inline">\(p\)</span> autoregressive components and <span class="math inline">\(q\)</span> moving average components. It can be expressed as <span id="eq-armapq"><span class="math display">\[
\phi^{p} (B)Y_{t} = \theta^{q} (B) \epsilon_{t},
\tag{4.13}\]</span></span> where <span class="math inline">\(\epsilon_t\)</span> is the zero-mean white noise with variance <span class="math inline">\(\sigma^2\)</span>, <span class="math inline">\(\phi^{p}(\lambda)\)</span> and <span class="math inline">\(\theta^{q}(\lambda)\)</span> are the polynomials (without common roots) of degree <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>, respectively.</p>
<p>The ARMA(<span class="math inline">\(p, q\)</span>) <a href="#eq-armapq" class="quarto-xref">Equation&nbsp;<span>4.13</span></a> can be expanded as follows: <span class="math display">\[
X_t - \phi_1 X_{t-1} - \dots - \phi_p X_{t-p} = \epsilon_t + \theta_1 \epsilon_{t-1} + \dots + \theta_q \epsilon_{t-q}.
\]</span></p>
<p><strong>ARMA(1,2)</strong></p>
<p>Short notation <span class="math inline">\(\phi^{1} (B)Y_{t} = \theta^{2} (B) \epsilon_{t}\)</span> expands to <span class="math display">\[
\left(1 - \phi_{1} B \right) Y_{t} = \left( 1 + \theta_{1} B + \theta_{2} B^{2} \right) \epsilon_{t}
\]</span> and gives <span class="math display">\[
Y_{t} - \phi_{1} Y_{t - 1} = \epsilon_{t} + \theta_{1} \epsilon_{t - 1} + \theta_{2}\epsilon_{t - 2}.
\]</span></p>
<p>Isolate <span class="math inline">\(Y_{t}\)</span> on the left side of the equation to get the final form of the expansion <span class="math display">\[
Y_{t} = \phi_{1} Y_{t -1} + \epsilon_{t} + \theta_{ 1} \epsilon_{t - 1} + \theta_{2} \epsilon_{t-2}.
\]</span></p>
<p><strong>ARMA(3,1)</strong></p>
<p>Short notation <span class="math inline">\(\phi^{3} (B)Y_{t} = \theta^{1} (B) \epsilon_{t}\)</span> expands to <span class="math display">\[
\left( 1 -  \phi_{1} B - \phi_{2} B^{2}  - \phi_{3} B^{3} \right) Y_{t} = \left( 1 + \theta_{1} B \right) \epsilon_{t}
\]</span> or <span class="math display">\[
Y_{t} - \phi_{1} Y_{t - 1} - \phi_{2} Y_{t - 2} - \phi_{3} Y_{t - 3} = \epsilon_{t} + \theta_{1} \epsilon_{t-1}.
\]</span></p>
<p>Isolating <span class="math inline">\(Y_{t}\)</span> gives the final form <span class="math display">\[
Y_{t} = \phi_{1} Y_{t - 1} + \phi_{2} Y_{t - 2} + \phi_{3} Y_{t - 3} + \epsilon_{t} + \theta_{1} \epsilon_{t-1}.
\]</span></p>
<p>In a mixed ARMA(<span class="math inline">\(p, q\)</span>) process (that is, <span class="math inline">\(p &gt; 0\)</span>, <span class="math inline">\(q &gt; 0\)</span>), neither the ACF nor the PACF cuts off abruptly. Both the ACF and PACF exhibit mixed exponential decay. This occurs because the AR component introduces mixed exponential decay into the ACF, while the MA component introduces mixed exponential decay into the PACF.</p>
</section><section id="summary-of-armaarma-models" class="level2" data-number="4.6"><h2 data-number="4.6" class="anchored" data-anchor-id="summary-of-armaarma-models">
<span class="header-section-number">4.6</span> Summary of AR/MA/ARMA models</h2>
<p>Use the following summary or <a href="#tbl-arma" class="quarto-xref">Table&nbsp;<span>4.1</span></a> to decide on the appropriate model specifications.</p>
<p>AR(<span class="math inline">\(p\)</span>) models: <span class="math inline">\(\phi^{p} (B)Y_{t}  = \epsilon_{t}\)</span></p>
<ul>
<li>ACF: <span class="math inline">\(p\)</span> initial spikes, then damps out as a mixed exponential decay of order <span class="math inline">\(p\)</span> (never 0)</li>
<li>PACF: <span class="math inline">\(p\)</span> initial spikes, then cuts off; PACF(<span class="math inline">\(h\)</span>) = 0 for <span class="math inline">\(h &gt; p\)</span>
</li>
</ul>
<p>MA(<span class="math inline">\(q\)</span>) models: <span class="math inline">\(Y_{t} = \theta^{q} (B) \epsilon_{t}\)</span></p>
<ul>
<li>ACF: <span class="math inline">\(q\)</span> initial spikes, then cuts off; ACF(<span class="math inline">\(h\)</span>) = 0 for <span class="math inline">\(h &gt; q\)</span>
</li>
<li>PACF: <span class="math inline">\(q\)</span> initial spikes, then damps out as a mixed exponential decay of order <span class="math inline">\(q\)</span> (never 0)</li>
</ul>
<p>ARMA(<span class="math inline">\(p,q\)</span>) models (<span class="math inline">\(p&gt;0\)</span>, <span class="math inline">\(q&gt;0\)</span>): <span class="math inline">\(\phi^{p} (B)Y_{t} = \theta^{q} (B) \epsilon_{t}\)</span></p>
<ul>
<li>ACF: has max (<span class="math inline">\(p, q\)</span>) initial spikes, then damps out as a mixed exponential decay driven by the AR(<span class="math inline">\(p\)</span>) component (never 0)</li>
<li>PACF: has max(<span class="math inline">\(p, q\)</span>) initial spikes, then damps out as a mixed exponential decay driven by the MA(<span class="math inline">\(q\)</span>) component (never 0)</li>
</ul>
<div id="tbl-arma" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Summary of ARMA(<span class="math inline">\(p, q\)</span>) models
</figcaption><div aria-describedby="tbl-arma-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead><tr class="header">
<th>Model</th>
<th>ACF</th>
<th>PACF</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>MA(<span class="math inline">\(q\)</span>)</td>
<td>Zero after lag <span class="math inline">\(q\)</span>
</td>
<td>Exponential decay</td>
</tr>
<tr class="even">
<td>AR(<span class="math inline">\(p\)</span>)</td>
<td>Exponential decay</td>
<td>Zero after lag <span class="math inline">\(p\)</span>
</td>
</tr>
<tr class="odd">
<td>ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>)</td>
<td>Mixed exponential decay</td>
<td>Mixed exponential decay</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>In practice, the final selection of ARMAâ€™s orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> (i.e., model specification) is often based on</p>
<ul>
<li>information criterion such as AIC or BIC or</li>
<li>forecast accuracy (e.g., PRMSE and PMAE of point forecasts for a testing set)</li>
</ul>
<p>Use the examples in <a href="s_practice.html#sec-acfpractice" class="quarto-xref"><span>Section E.2</span></a> to practice the implementation of the rules in <a href="#tbl-arma" class="quarto-xref">Table&nbsp;<span>4.1</span></a>.</p>
</section><section id="example-analysis" class="level2" data-number="4.7"><h2 data-number="4.7" class="anchored" data-anchor-id="example-analysis">
<span class="header-section-number">4.7</span> Example analysis</h2>
<p>Consider a univariate time series <span class="math inline">\(Y_t\)</span> of 1918â€“2017 annual landings of golden tilefish in the U.S. North Atlantic region <span class="citation" data-cites="Nesslage:etal:2021:environmental lyubchich3732840">(<a href="references.html#ref-lyubchich3732840" role="doc-biblioref">Lyubchich and Nesslage 2020</a>; <a href="references.html#ref-Nesslage:etal:2021:environmental" role="doc-biblioref">Nesslage et al. 2021</a>)</span>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/tilefish.csv"</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html">ts</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Landings</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>, frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>First, plot the data (<a href="#fig-Yt" class="quarto-xref">Figure&nbsp;<span>4.8</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Landings (tonne)"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-Yt" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Yt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-Yt-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Yt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.8: Annual golden tilefish landings.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are some missing values in the time series, which present a problem for model fitting. Generally, ARMA models assume the input time series is ordered chronologically, with the same time differences between all consecutive observations (equally-spaced time series); these models cannot handle missing values. Omitting the missing values to bridge the gaps, such as using the function <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code>, is not recommended since it breaks the time sequence (the time series becomes unequally-spaced) and may bias estimates of the time dependencies. Some functions may work with missing values, but their ways of handling the NAs may differ. For example, <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code> with the argument <code>na.action = na.pass</code> computes the ACF using all available pairs of observations, and <code><a href="https://rdrr.io/r/stats/arima.html">arima()</a></code> generally allows missing values. However, one may prefer to impute missing values, with commonly used methods like linear interpolation of neighboring observations or an AR model.</p>
</div>
</div>
<p>Since we are just learning about AR models, consider filling in the missing values using linear interpolation (<a href="#fig-Yt2" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/na.interp.html">na.interp</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">21</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Landings</span><span class="op">)</span>, <span class="st">"red"</span>, <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Landings (tonne)"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-Yt2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Yt2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-Yt2-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Yt2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.9: Annual golden tilefish landings, with the imputed values shown in red.
</figcaption></figure>
</div>
</div>
</div>
<p>If no obvious trend, plot sample ACF and PACF (<a href="#fig-Ytacf" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">Y</span>, type <span class="op">=</span> <span class="st">"partial"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-Ytacf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Ytacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-Ytacf-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Ytacf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.10: Estimated ACF and PACF of the annual golden tilefish landings <span class="math inline">\(Y_t\)</span>.
</figcaption></figure>
</div>
</div>
</div>
<p>The <em>ACF decays faster than linearly</em> (some indication of stationarity), even though the autocorrelations are statistically significant up to the lag of 6 years (<a href="#fig-Ytacf" class="quarto-xref">Figure&nbsp;<span>4.10</span></a> A). The <em>PACF is non-zero up to lag 2</em> (cuts off after lag 2; <a href="#fig-Ytacf" class="quarto-xref">Figure&nbsp;<span>4.10</span></a> B). There is another significant spike at lag 7, but it is likely due to the sample variability and can be ignored. Knowing the expected behavior of ACF and PACF for ARMA models (see <a href="#tbl-arma" class="quarto-xref">Table&nbsp;<span>4.1</span></a>), AR(2) can be suggested in this case, which is equivalent to ARMA(2,0).</p>
<p>Given the potential sample variability affecting the estimates of ACF and PACF, there could be other model specifications, close to the selected one, that may perform similarly or even slightly better when compared to the one selected based on the visual analysis. For example, we can check other suitable combinations: ARMA(1,0) and ARMA(1,1).</p>
<p>We need some quantitative criteria to select the best model. The code below uses a â€˜manualâ€™ approach of calculating Akaike and Bayesian information criteria (AIC and BIC) to select the model from the specified set, but the next section lists R functions that do it more automatically.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Combinations of p and q</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                      q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For each combination, fit the model and extract AIC and BIC values</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.html">arima</a></span><span class="op">(</span><span class="va">Y</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, <span class="va">results</span><span class="op">$</span><span class="va">q</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">aic</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mod</span><span class="op">$</span><span class="va">aic</span></span>
<span>    <span class="va">results</span><span class="op">$</span><span class="va">bic</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">results</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   p q  aic  bic
#&gt; 1 2 0 1509 1520
#&gt; 2 1 0 1512 1519
#&gt; 3 1 1 1509 1519</code></pre>
</div>
</div>
<section id="automatic-model-selection" class="level3" data-number="4.7.1"><h3 data-number="4.7.1" class="anchored" data-anchor-id="automatic-model-selection">
<span class="header-section-number">4.7.1</span> Automatic model selection</h3>
<p>The function <code><a href="https://rdrr.io/r/stats/ar.html">stats::ar()</a></code> by default uses the Yuleâ€“Walker method to estimate the coefficients and AIC to select the best order for AR(<span class="math inline">\(p\)</span>) model, where the maximum of <span class="math inline">\(p\)</span> can be set by the user.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ar.html">ar</a></span><span class="op">(</span><span class="va">Y</span>, order.max <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; ar(x = Y, order.max = 11)
#&gt; 
#&gt; Coefficients:
#&gt;      1       2  
#&gt;  1.006  -0.209  
#&gt; 
#&gt; Order selected 2  sigma^2 estimated as  201769</code></pre>
</div>
</div>
<p>The function <code><a href="https://rdrr.io/pkg/funtimes/man/ARest.html">funtimes::ARest()</a></code> is a wrapper for <code><a href="https://rdrr.io/r/stats/ar.html">stats::ar()</a></code>. It adds a difference-based estimator by <span class="citation" data-cites="Hall:VanKeilegom:2003">Hall and Van Keilegom (<a href="references.html#ref-Hall:VanKeilegom:2003" role="doc-biblioref">2003</a>)</span>, which is now used by default, and also switches between BIC or AIC as the model selection criterion. The selection is still done only for the order <span class="math inline">\(p\)</span> in AR(<span class="math inline">\(p\)</span>), without considering the possibility of MA terms.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">funtimes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/funtimes/man/ARest.html">ARest</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.796</code></pre>
</div>
</div>
<p>To check the correspondence with <code><a href="https://rdrr.io/r/stats/ar.html">stats::ar()</a></code>, change the method and fix the <code>ar.order</code> (turn off its automatic selection):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">funtimes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/funtimes/man/ARest.html">ARest</a></span><span class="op">(</span><span class="va">Y</span>, ar.method <span class="op">=</span> <span class="st">"yw"</span>, ar.order <span class="op">=</span> <span class="fl">2</span>, ic <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1]  1.006 -0.209</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>BIC selects more parsimonious models than AIC does. Such simpler models are usually preferred for forecasting tasks.</p>
</div>
</div>
<p>The function <code><a href="https://fable.tidyverts.org/reference/ARIMA.html">fable::ARIMA()</a></code> searches over possible ARMA models within some order constraints (the default maximal orders and search strategy are different from the two functions above â€“ see help files for each function in R). This function is a successor of the function <code><a href="https://pkg.robjhyndman.com/forecast/reference/auto.arima.html">forecast::auto.arima()</a></code> and is probably the most comprehensive R function for estimating and selecting ARMA models. It allows to fit and select not only ARMA(<span class="math inline">\(p,q\)</span>) models, but also more complex models that will be described later in the course.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fable.tidyverts.org">fable</a></span><span class="op">)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span>, ic <span class="op">=</span> <span class="st">"bic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/report.html">report</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Series: Y 
#&gt; Model: ARIMA(1,0,0) w/ mean 
#&gt; 
#&gt; Coefficients:
#&gt;          ar1  constant
#&gt;       0.8321     150.9
#&gt; s.e.  0.0537      42.7
#&gt; 
#&gt; sigma^2 estimated as 203947:  log likelihood=-753
#&gt; AIC=1512   AICc=1512   BIC=1519</code></pre>
</div>
</div>
<p>The AIC in <code><a href="https://rdrr.io/r/stats/ar.html">ar()</a></code> selects AR(2), while BIC in <code><a href="https://rdrr.io/pkg/funtimes/man/ARest.html">funtimes::ARest()</a></code> and <code><a href="https://fable.tidyverts.org/reference/ARIMA.html">fable::ARIMA()</a></code> selects AR(1). Note, the <code><a href="https://rdrr.io/r/stats/ar.html">ar()</a></code> estimates suggest a model that might be close to being nonstationary, since the absolute value of the estimated coefficient is close to 1. Formally check the stationarity of the AR(2) model below.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calculate the roots of characteristic polynomial</span></span>
<span><span class="va">roots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/polyroot.html">polyroot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/ar.html">ar</a></span><span class="op">(</span><span class="va">Y</span>, order.max <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">$</span><span class="va">ar</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The AR model is causal (future-independent) </span></span>
<span><span class="co"># and stationary if |roots| &gt; 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Mod</a></span><span class="op">(</span><span class="va">roots</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] TRUE</code></pre>
</div>
</div>
<p>For now, continue with the model ARMA(1,0), which is equivalent to AR(1). Our next step is the residual diagnostics â€“ check the residuals for homoskedasticity, uncorrelatedness, and normality (<a href="#fig-resfable" class="quarto-xref">Figure&nbsp;<span>4.11</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggtime</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggtime/man/gg_tsresiduals.html">gg_tsresiduals</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-resfable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-resfable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-resfable-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resfable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.11: Residual diagnostics for the ARMA(1,0) model estimated using the package <code>fable</code>.
</figcaption></figure>
</div>
</div>
</div>
<p>If the residuals do not violate the assumptions, proceed with forecasting (<a href="#fig-fcstfable" class="quarto-xref">Figure&nbsp;<span>4.12</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-fcstfable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fcstfable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-fcstfable-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fcstfable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.12: Predictions 10 steps ahead from the ARMA(1,0) model estimated using the package <code>fable</code>.
</figcaption></figure>
</div>
</div>
</div>
<p>However, the syntax and outputs of the package <code>fable</code> are quite different from the typical R alternatives. See <a href="#fig-res" class="quarto-xref">Figure&nbsp;<span>4.13</span></a> with results still plotted using the package <code>ggplot2</code>, but obtained using the base-R functions. Also, see the base-R function <code><a href="https://rdrr.io/r/stats/tsdiag.html">tsdiag()</a></code> for residual diagnostics.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.html">arima</a></span><span class="op">(</span><span class="va">Y</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">e</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">$</span><span class="va">residuals</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Residuals"</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggqqplot.html">ggqqplot</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Standard normal quantiles"</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">forecast</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span><span class="va">m</span>, h <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="op">(</span><span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span><span class="op">)</span> <span class="op">/</span> <span class="va">p4</span> <span class="op">+</span></span>
<span>    <span class="fu">plot_annotation</span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-res" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-res-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-res-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.13: Residual diagnostics and predictions 10 steps ahead from the ARMA(1,0) model estimated using the base-R function <code><a href="https://rdrr.io/r/stats/arima.html">stats::arima()</a></code>.
</figcaption></figure>
</div>
</div>
</div>
<p>Using the estimated residuals, <span class="math inline">\(\hat{\epsilon}_t = Y_t - \hat{Y}_t\)</span>, we can get the â€˜fittedâ€™ values, <span class="math inline">\(\hat{Y}_t\)</span> (technically, these are one-step-ahead predictions), see <a href="#fig-Ytfit" class="quarto-xref">Figure&nbsp;<span>4.14</span></a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Fit</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">e</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">Fit</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="st">"Landings (tonne)"</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div id="fig-Ytfit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Ytfit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="l04_arma_files/figure-html/fig-Ytfit-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Ytfit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.14: Oberved time series (black) and one-step-ahead predictions (red) from the ARMA(1,0) model.
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="conclusion" class="level2" data-number="4.8"><h2 data-number="4.8" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">4.8</span> Conclusion</h2>
<p>We defined AR, MA, and ARMA models and showed that time series processes corresponding to such models satisfy the conditions of weak stationarity.</p>
<p>Using ACF and PACF plots, we can select the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> to specify an ARMA model, but we also can use a variety of functions running different evaluations and tests for competitive models.</p>
<p>We face the choice of different methods to estimate (i.e., estimators) and methods to compare models.</p>
<p>The most often used estimators for ARMA models are</p>
<ul>
<li>maximum likelihood,</li>
<li>Yuleâ€“Walker, and</li>
<li>Burg.</li>
</ul>
<p>The OLS-based estimator is used less frequently.</p>
<p>Methods to compare competing models may involve</p>
<ul>
<li>log-likelihood, MAE, RMSE, and information criteria to assess in-sample (training) goodness-of-fit;</li>
<li>diagnostics checks of residuals (discard models if their residuals do not pass the tests);</li>
<li>comparisons of models on a testing set (PMAE, PRMSE, coverage, and width of prediction intervals).</li>
</ul>
<p>For each of these options, there are multiple R functions available, or can be written from scratch.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Brockwell:Davis:2002" class="csl-entry" role="listitem">
Brockwell PJ, Davis RA (2002) Introduction to time series and forecasting, 2nd edn. Springer, New York, NY, USA
</div>
<div id="ref-Hall:VanKeilegom:2003" class="csl-entry" role="listitem">
Hall P, Van Keilegom I (2003) Using difference-based methods for inference in nonparametric regression with time series errors. Journal of the Royal Statistical Society: Series B (Statistical Methodology) 65:443â€“456. <a href="https://doi.org/10.1111/1467-9868.00395">https://doi.org/10.1111/1467-9868.00395</a>
</div>
<div id="ref-lyubchich3732840" class="csl-entry" role="listitem">
Lyubchich V, Nesslage G (2020) <a href="https://doi.org/10.5281/zenodo.3732839"><span class="nocase">Environmental drivers of golden tilefish fisheries v1.0</span></a>. Version v1.0. Zenodo
</div>
<div id="ref-Nesslage:etal:2021:environmental" class="csl-entry" role="listitem">
Nesslage G, Lyubchich V, Nitschke P, et al (2021) Environmental drivers of golden tilefish (<span class="nocase">Lopholatilus chamaeleonticeps</span>) commercial landings and catch-per-unit-effort. Fisheries Oceanography 30:608â€“622. <a href="https://doi.org/10.1111/fog.12540">https://doi.org/10.1111/fog.12540</a>
</div>
<div id="ref-Shumway:Stoffer:2014" class="csl-entry" role="listitem">
Shumway RH, Stoffer DS (2014) Time series analysis and its applications with <span>R</span> examples, 3-EZ. Free Texts in Statistics
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./l03_smoothing.html" class="pagination-link" aria-label="Smoothing, Detrending, and Deseasonalizing">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Smoothing, Detrending, and Deseasonalizing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./l05_arima.html" class="pagination-link" aria-label="Autoregressive Integrated Moving Average (ARIMA) Models">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Autoregressive Integrated Moving Average (ARIMA) Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/vlyubchich/tsar/edit/master/l04_arma.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/vlyubchich/tsar/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>