<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Time Series Analysis - 4&nbsp; Autoregressive Moving Average (ARMA) Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./l05_arima.html" rel="next">
<link href="./l03_smoothing.html" rel="prev">
<link href="./TSAfav.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Time Series Analysis</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l01_regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Review of Linear Regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l02_tsintro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Time Series Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l03_smoothing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Smoothing, Detrending, and Deseasonalizing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l04_arma.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l05_arima.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Autoregressive Integrated Moving Average (ARIMA) Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l06_garch.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generalized Autoregressive Conditional Heteroskedasticity (GARCH) Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l07_trendtest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Trend Detection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l08_tsreg1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Time Series Regression with Trends</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l09_tsreg2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time Series Regression with Correlated Errors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./l10_spectral.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spectral Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software.html" class="sidebar-item-text sidebar-link">Software</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s1_wls.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Weighted least squares</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./s2_gls.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Generalized least squares</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">4.1</span>  Introduction</a></li>
  <li><a href="#autoregressive-ar-models" id="toc-autoregressive-ar-models" class="nav-link" data-scroll-target="#autoregressive-ar-models"><span class="toc-section-number">4.2</span>  Autoregressive (AR) models</a></li>
  <li><a href="#the-yulewold-representation-and-linear-processes" id="toc-the-yulewold-representation-and-linear-processes" class="nav-link" data-scroll-target="#the-yulewold-representation-and-linear-processes"><span class="toc-section-number">4.3</span>  The Yule–Wold representation and linear processes</a></li>
  <li><a href="#moving-average-ma-models" id="toc-moving-average-ma-models" class="nav-link" data-scroll-target="#moving-average-ma-models"><span class="toc-section-number">4.4</span>  Moving average (MA) models</a></li>
  <li><a href="#arma" id="toc-arma" class="nav-link" data-scroll-target="#arma"><span class="toc-section-number">4.5</span>  ARMA</a></li>
  <li><a href="#summary-of-armaarma-models" id="toc-summary-of-armaarma-models" class="nav-link" data-scroll-target="#summary-of-armaarma-models"><span class="toc-section-number">4.6</span>  Summary of AR/MA/ARMA models</a></li>
  <li><a href="#example-analysis" id="toc-example-analysis" class="nav-link" data-scroll-target="#example-analysis"><span class="toc-section-number">4.7</span>  Example analysis</a>
  <ul class="collapse">
  <li><a href="#automatic-model-selection" id="toc-automatic-model-selection" class="nav-link" data-scroll-target="#automatic-model-selection"><span class="toc-section-number">4.7.1</span>  Automatic model selection</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="toc-section-number">4.8</span>  Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Moving Average (ARMA) Models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>The goal of this lecture is to introduce a broad class of models for stationary time series – autoregressive moving average (ARMA) models. You should recognize the difference between the AR and MA components and learn how to implement these models in practice.</p>
<p><strong>Objectives</strong></p>
<ol type="1">
<li>Define AR(<span class="math inline">\(p\)</span>), MA(<span class="math inline">\(q\)</span>), and ARMA(<span class="math inline">\(p,q\)</span>) models for stationary time series.</li>
<li>Identify the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> using ACF and PACF plots.</li>
<li>Estimate models using different methods and select a model using an information criterion (AIC or BIC).</li>
<li>Diagnose the residuals of an ARMA model.</li>
<li>Obtain forecasts from ARMA models.</li>
</ol>
<p><strong>Reading materials</strong></p>
<ul>
<li>Chapters 2, 3, and 5 in <span class="citation" data-cites="Brockwell:Davis:2002">Brockwell and Davis (<a href="references.html#ref-Brockwell:Davis:2002" role="doc-biblioref">2002</a>)</span></li>
</ul>
<section id="introduction" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">4.1</span> Introduction</h2>
<p>After removing or modeling a trend and strong seasonality in a time series, we need to take care of the stationary remainder, which may be autocorrelated or conditionally heteroskedastic. Here we introduce a broad class of ARMA models that deal with autocorrelation in time series.</p>
<p>Recall that a time series is (weakly) stationary if its mean and autocovariance do not depend on time, <span class="math inline">\(t\)</span>; autocovariance depends only on the lag <span class="math inline">\(h\)</span>. We will use these two conditions to show that the time series processes that we will model as AR, MA, or ARMA are stationary. Remember that the presence of autocorrelation does not mean that there is a trend.</p>
<p>We start by checking the two conditions for other typical univariate processes: white noise and random walk.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducible random number generation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> 300L</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Lag <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Most of the examples in this lecture are simulated to show how sample autocorrelations may differ from theoretical ones, even if the simulated time series are sampled from a process of a certain type. All simulated series are of length 300.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Check the stationarity of white noise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let <span class="math inline">\(X_t\)</span> be a white noise series, <span class="math inline">\(X_t \sim \mathrm{WN}(0, \sigma^2)\)</span>. Show that <span class="math inline">\(X_t\)</span> is weakly stationary.</p>
<p><span class="math inline">\(\mathrm{E}(X_t) = 0\)</span> for all <span class="math inline">\(t\)</span> <span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{E}(X_t)\)</span> is independent of <span class="math inline">\(t\)</span>.</p>
<p>Now check the autocovariance <span class="math display">\[
\mathrm{cov}(X_t, X_{t+h}) =
\begin{cases}
\mathrm{cov}(X_t, X_t) &amp; \text{if } h = 0\\
0                      &amp; \text{otherwise}
\end{cases} =
\begin{cases}
\mathrm{var}(X_t) &amp; \text{if } h = 0\\
0                 &amp; \text{otherwise}
\end{cases} =
\begin{cases}
\sigma^2 &amp; \text{if } h = 0\\
0        &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p><span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{cov}(X_t, X_{t+h})\)</span> does not depend on <span class="math inline">\(t\)</span>, depends only on <span class="math inline">\(h\)</span>.</p>
<p>Both conditions of weak stationarity are satisfied, <span class="math inline">\(X_t\)</span> is weakly stationary.</p>
</div>
</div>
<p>See <a href="#fig-wn">Figure&nbsp;<span>4.1</span></a> with plots for <span class="math inline">\(X_t \sim \mathrm{WN}(0, \sigma^2)\)</span>, where <span class="math inline">\(\sigma = 2\)</span>. More specifically, <span id="eq-wn"><span class="math display">\[
X_t \sim \text{i.i.d.}\; N(0, \sigma^2);\; \sigma = 2.
\tag{4.1}\]</span></span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical ACF, PACF</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>RHO <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(Lag)))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rnorm</span>(T, <span class="at">sd =</span> <span class="dv">2</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">ACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> ACF)) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical ACF"</span>) <span class="sc">+</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">PACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical PACF"</span>) <span class="sc">+</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(X) <span class="sc">+</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X) <span class="sc">+</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_spacer</span>() <span class="sc">+</span> p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5) <span class="sc">+</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-wn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-wn-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: White noise as specified in <a href="#eq-wn">Equation&nbsp;<span>4.1</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember that ACF(0) = PACF(0) = 1 always. Some R plotting functions show results for the zero lag (e.g., <code>acf()</code>), some do not (e.g., <code>pacf()</code> and the function <code>forecast::ggAcf()</code> used here).</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Check the stationarity of random walk
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the same for random walk <span class="math inline">\(S_t\)</span>. <span class="math inline">\(S_t = \sum_{i=1}^t{X_t}\)</span>, where <span class="math inline">\(X_t \sim \text{i.i.d.}(0,\sigma^2)\)</span>.</p>
<p><span class="math inline">\(\mathrm{E}(S_t) = \mathrm{E}(\sum_{i=1}^t{X_t}) = 0\)</span> <span class="math inline">\(\Rightarrow\)</span> <span class="math inline">\(\mathrm{E}(X_t)\)</span> does not depend on <span class="math inline">\(t\)</span>.</p>
<p>Now check the autocovariance <span class="math display">\[
\begin{split}
\mathrm{cov}(S_t, S_{t+h}) &amp;= \mathrm{cov}(S_t, S_t + X_{t+1}+\dots + X_{t+h})\\
&amp; = \mathrm{cov}(S_t, S_t) + \mathrm{cov}(S_t, X_{t+1}+\dots + X_{t+h})\\
&amp; = \mathrm{var}(S_t) + 0\\
&amp; = \mathrm{var}\left(\sum_{i=1}^t{X_t}\right) \\
&amp; = \sum_{i=1}^t\mathrm{var}(X_t)\\
&amp; = t\sigma^2
\end{split}
\]</span></p>
<p>Autocovariance of <span class="math inline">\(S_t\)</span> depends on time, <span class="math inline">\(S_t\)</span> is not stationary. Also, notice that <span class="math inline">\(S_t = S_{t-1} + X_t\)</span>, that is, <span class="math inline">\(S_t\)</span> is a nonstationary AR(1) process with <span class="math inline">\(\phi_1 = 1\)</span>.</p>
</div>
</div>
<p>Random walk patterns are widely found in nature, for example, in the phenomenon of Brownian motion. Notice the linear decay in ACF of nonstationary time series (<a href="#fig-rw">Figure&nbsp;<span>4.2</span></a>).</p>
<p><span id="eq-rw"><span class="math display">\[
S_t = \sum_{i = 1}^t X_i,\; \text{where}\; X_t \sim \mathrm{i.i.d.}(0, \sigma^2);\; \sigma = 2.
\tag{4.2}\]</span></span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>RW0 <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">cumsum</span>(X))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(RW0) <span class="sc">+</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(RW0) <span class="sc">+</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(RW0, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rw" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-rw-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Zero-mean random walk as specified in <a href="#eq-rw">Equation&nbsp;<span>4.2</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Random walk may look very different if the i.i.d. process has a non-zero mean. Here is a random walk with drift (<a href="#fig-rw2">Figure&nbsp;<span>4.3</span></a>): <span id="eq-rw2"><span class="math display">\[
S_t = \sum_{i = 1}^t X_i,\; \text{where}\; X_t \sim \mathrm{i.i.d.}(a, \sigma^2);\; a = 0.2,\; \sigma = 2.
\tag{4.3}\]</span></span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>RW2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">cumsum</span>(X <span class="sc">+</span> <span class="fl">0.2</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(RW2) <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(RW2) <span class="sc">+</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(RW2, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rw2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-rw2-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: White noise with drift as specified in <a href="#eq-rw2">Equation&nbsp;<span>4.3</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="autoregressive-ar-models" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="autoregressive-ar-models"><span class="header-section-number">4.2</span> Autoregressive (AR) models</h2>
<p><strong>AR(1) model</strong></p>
<p>We are already familiar with an AR(1) model <span class="math display">\[
Y_{t} = \phi_{1}  Y_{t -1} + \epsilon_{t},
\]</span> where</p>
<ul>
<li><span class="math inline">\(\epsilon_{t}\)</span> is white noise (<span class="math inline">\(\mathrm{E}(\epsilon_{t}) = 0\)</span> and <span class="math inline">\(\mathrm{E}(\epsilon_{t}^2) = \sigma^{2}_{\epsilon}\)</span>),</li>
<li><span class="math inline">\(\epsilon_{t}\)</span> is independent of <span class="math inline">\(Y_{t - k}, \dots, Y_{t - 1}\)</span>,</li>
<li><span class="math inline">\(\phi_{1}\)</span> is the coefficient of autoregression.</li>
</ul>
<p>The AR(1) model can be rewritten as <span class="math display">\[
(1 - \phi_{1} B) Y_{t} = \epsilon_{t},
\]</span> or in even more compact notation as <span class="math display">\[
\phi(B)Y_t = \epsilon_t,
\]</span> where <span class="math inline">\(\phi(\lambda)\)</span> is the polynomial <span class="math inline">\(\phi (\lambda) = 1 - \phi_{1} \lambda\)</span>.</p>
<p>Let us find the variance of <span class="math inline">\(Y_{t}\)</span> <span class="math display">\[
\begin{split}
\mathrm{var} (Y_{t} ) = \mathrm{E} ( \phi_{1} Y_{t - 1} + \epsilon_{t})^{2} &amp; =  \mathrm{E} ( \phi^{2}_{1} Y^{2}_{t - 1} + 2 \phi_{1} Y_{t-1}  \epsilon_{t} + \epsilon^{2}_{ t}) \\
\\
&amp; = \phi^{2}_{1} \mathrm{E}(Y^{2}_{t - 1}) + 2\phi_{1} \mathrm{E} (Y_{t - 1} \epsilon_{t}) + \mathrm{E}(\epsilon^{2}_{t}) \\
\\
&amp; = \phi^{2}_{1} \mathrm{var} \left( Y_{t -1} \right) + 0 + \sigma^{2}_{\epsilon} \\
\\
&amp; = \phi^{2}_{1} \mathrm{var} \left( Y_{t -1} \right) + \sigma^{2}_{\epsilon}.
\end{split}
\]</span></p>
<p>Hence, if <span class="math inline">\(\phi_{1} \neq \pm 1\)</span>, then <span id="eq-ar1var"><span class="math display">\[
\sigma^{2}_{Y} = \frac{\sigma^{2}_{\epsilon}} {1 - \phi^{2}_{1}}.
\tag{4.4}\]</span></span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that for <a href="#eq-ar1var">Equation&nbsp;<span>4.4</span></a> to make sense, we require <span class="math inline">\(|\phi_{1}| &lt; 1\)</span>. This is the condition under which AR(1) process is (<em>weakly</em>) <em>stationary</em>. E.g., if <span class="math inline">\(\phi_{1} = \pm 1\)</span> then the process is a random walk and is also not stationary. We shall see later that all AR processes require some condition of this nature.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Check stationarity of AR(1)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show that AR(1) process <span class="math inline">\(Y_t\)</span> is stationary, <span class="math inline">\(Y_t = \phi Y_{t-1} + Z_t\)</span>, <span class="math inline">\(|\phi| &lt; 1\)</span>, <span class="math inline">\(Z_t \sim \mathrm{WN}(0, \sigma^2)\)</span>.</p>
<p><span class="math display">\[
\begin{split}
\mathrm{E}(Y_t) &amp;= \mathrm{E}(\phi Y_{t-1} + Z_t)\\
&amp; = \phi \mathrm{E}(Y_{t-1}) + \mathrm{E}(Z_t)\\
&amp; = \phi^2 \mathrm{E}(Y_{t-2}) + 0\\
&amp; = \phi^3 \mathrm{E}(Y_{t-3})\\
&amp; = \dots\\
&amp; = \phi^N \mathrm{E}(Y_{t-N})\\
\lim_{N \rightarrow \infty} \mathrm{E}(Y_t) &amp;= \lim_{N \rightarrow \infty} \phi^N \mathrm{E}(Y_{t-N}) = 0
\end{split}
\]</span> Therefore, the mean of <span class="math inline">\(Y_t\)</span> does not depend on time.</p>
<p>Now check autocovariance. For <span class="math inline">\(h=0\)</span>, <span class="math inline">\(\mathrm{cov}(Y_t, Y_{t}) = \mathrm{var}(Y_t) = \sigma^2_Y\)</span>, which is derived in <a href="#eq-ar1var">Equation&nbsp;<span>4.4</span></a> and does not depend on time.</p>
<p>For <span class="math inline">\(h \neq 0\)</span>, <span class="math display">\[
\begin{split}
\mathrm{cov}(Y_t, Y_{t-h}) &amp;= \mathrm{cov}(\phi Y_{t-1} + Z_t, Y_{t-h})\\
&amp; = \mathrm{cov}(\phi Y_{t-1}, Y_{t-h}) + \mathrm{cov}(Z_t, Y_{t-h})\\
&amp; = \phi \mathrm{cov}(Y_{t-1}, Y_{t-h}) + 0\\
&amp; = \phi \mathrm{cov}(\phi Y_{t-2} + Z_{t-1}, Y_{t-h})\\
&amp; = \phi^2 \gamma_Y(h-2)\\
&amp; = \dots\\
&amp; = \phi^h \gamma_Y(0) \\
&amp; = \phi^h \sigma_Y^2,
\end{split}
\]</span> thus autocovariance does not depend on time, depends on lag <span class="math inline">\(h\)</span>.</p>
<p>Both conditions for weak stationarity are satisfied, the <span class="math inline">\(Y_t\)</span> specified above is weakly stationary.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Additionally, see that the ACF of this process <span class="math display">\[
\rho_Y(h) = \frac{\gamma_Y(h)}{\gamma_Y(0)} = \frac{\phi^h \gamma_Y(0)}{\gamma_Y(0)} = \phi^h
\]</span> shows exponential decay. Remember this about AR processes.</p>
</div>
</div>
<p><strong>AR(<span class="math inline">\(p\)</span>) model</strong></p>
<p>Now we can extend our AR(1) model to <span id="eq-ARp"><span class="math display">\[
\begin{split}
Y_{t} &amp;= \phi_{1} Y_{t  - 1} + \phi_{2} Y_{t - 2} + \dots + \phi_{p} Y_{t - p} + \epsilon_{t} \\
&amp;=\sum_{i=1}^p\phi_iY_{t-i} + \epsilon_t
\end{split}
\tag{4.5}\]</span></span> with <span class="math inline">\(\epsilon_{t}\)</span> independent of <span class="math inline">\(Y_{t - k}, \dots , Y_{t - 1}\)</span>; <span class="math inline">\(p \in \mathbb{N}^{+}\)</span>. This model is called <em>an autoregressive model of order</em> <span class="math inline">\(p\)</span>, or simply <em>an AR(<span class="math inline">\(p\)</span>) model</em>.</p>
<p>Similarly to AR(1), every AR(<span class="math inline">\(p\)</span>) model may be rewritten as <span class="math display">\[
\left(1 -  \sum^{p}_{i = 1} \phi_{i} B^{i} \right) Y_{t} = \epsilon_{t},
\]</span> or in more compact notation as <span class="math display">\[
\phi (B) Y_t = \epsilon_t,
\]</span> where <span class="math inline">\(\phi(\lambda)\)</span> is the polynomial <span class="math inline">\(\phi(\lambda) = 1 - \phi_{1} \lambda - \phi_{2} \lambda^{2} - \dots - \phi_{p} \lambda^{p}\)</span>.</p>
<p>The stationarity condition for AR(<span class="math inline">\(p\)</span>) model is defined through the polynomial <span class="math inline">\(\phi(\lambda)\)</span>. Specifically, <em>all the roots of the function <span class="math inline">\(\phi(\lambda)\)</span> lie outside the unit circle in the complex plane</em>.</p>
<p>To compute ACVF and ACF for the AR(<span class="math inline">\(p\)</span>) model, multiplying both sides of <a href="#eq-ARp">Equation&nbsp;<span>4.5</span></a> by <span class="math inline">\(Y_{t - k}\)</span> for <span class="math inline">\(k \geqslant p\)</span> and taking expectations yields <span class="math display">\[
\begin{split}
\mathrm{E} \left( Y_{t} Y_{t - k} \right) &amp; =  \mathrm{E} \left( \phi_{1} Y_{t-1} Y_{t-k} + \phi_{2} Y_{t-2} Y_{t-k} + \dots + \phi_{p} Y_{t -p} Y_{t - k} + \epsilon_{t} Y_{t -k} \right) \\
&amp; =  \phi_{1}  \mathrm{E} \left( Y_{t  - 1} Y_{t - k} \right) + \phi_{2} \mathrm{E} \left( Y_{t - 2} Y_{t - k} \right) + \dots+ \phi_{p} \mathrm{E} \left(Y_{t - p} Y_{t - k} \right) + \mathrm{E} \left( \epsilon_{t} Y_{t  - k} \right).
\end{split}
\]</span></p>
<p>Thus, we get autocovariances <span class="math display">\[
\gamma(k) = \phi_{1}\gamma(k -1) + \phi_{2}\gamma(k - 2) + \dots + \phi_{p} \gamma(k  - p),
\]</span> which turns into a <em>mixed exponential decay of order</em> <span class="math inline">\(p\)</span> for the ACF <span class="math display">\[
\rho(k) = \phi_{1} \rho(k - 1) + \phi_{2} \rho(k - 2) + \dots + \phi_{p} \rho(k - p).
\]</span></p>
<p>To identify the decay, we need the <span class="math inline">\(p\)</span> starting correlations <span class="math inline">\(\rho(1), \rho(2), \dots, \rho(p)\)</span>, which we can find from the parameters <span class="math inline">\(\phi_{1}, \phi_{2}, \dots, \phi_{p}\)</span>.</p>
<p><strong>PACF of AR processes</strong></p>
<p>An AR(<span class="math inline">\(p\)</span>) model implies <span class="math inline">\(Y_{t+h} = \sum_{i=1}^p\phi_{i} Y_{t + h - i} + \epsilon_{t+h}\)</span>, where the roots of <span class="math inline">\(\phi(\lambda)\)</span> are outside the unit circle. When <span class="math inline">\(h &gt; p\)</span>, the regression of <span class="math inline">\(Y_{t+h}\)</span> on <span class="math inline">\(\{ Y_{t+1},\dots, Y_{t+h-1}\}\)</span>, is <span class="math display">\[
\hat{Y}_{t+h} = \sum^p_{i=1} \phi_i Y_{t+h-i}.
\]</span> Thus, when <span class="math inline">\(h &gt; p\)</span>, <span class="math display">\[
\rho_{hh} = \mathrm{cor}(Y_{t+h}-\hat{Y}_{t+h}, Y_t - \hat{Y}_t) = \mathrm{cor}(\epsilon_{t+h}, Y_t - \hat{Y}_t) = 0,
\]</span> because, by the causality of the process, <span class="math inline">\(Y_t - \hat{Y}_t\)</span>, depends only on <span class="math inline">\(\{ \epsilon_{t+h-1}, \epsilon_{t+h-2},\dots \}\)</span>.</p>
<p>When <span class="math inline">\(h\leqslant p\)</span>, <span class="math inline">\(\rho_{hh}\)</span> is not zero, and <span class="math inline">\(\rho_{11}, \dots, \rho_{p-1,p-1}\)</span> are not necessarily zero.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The important conclusion is that the PACF of an AR(<span class="math inline">\(p\)</span>) process necessarily cuts off (PACF = 0) after lag <span class="math inline">\(p\)</span>.</p>
</div>
</div>
<p>See the plots for the following AR(1) process in <a href="#fig-ar1">Figure&nbsp;<span>4.4</span></a>: <span id="eq-ar1"><span class="math display">\[
X_t = \phi_1 X_{t-1} + \epsilon_t;\; \epsilon_t \sim N(0,\sigma^2);\; \phi_1=0.6,\; \sigma = 1.
\tag{4.6}\]</span></span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical ACF, PACF</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>RHO <span class="ot">&lt;-</span> phi<span class="sc">^</span>Lag</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, phi, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(Lag) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ar =</span> phi), <span class="at">n =</span> T)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">ACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> ACF)) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical ACF"</span>) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">PACF =</span> ALPHA), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical PACF"</span>) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(X) <span class="sc">+</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X) <span class="sc">+</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_spacer</span>() <span class="sc">+</span> p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ar1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-ar1-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: AR(1) process as specified in <a href="#eq-ar1">Equation&nbsp;<span>4.6</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>See the plots for the following AR(1) process in <a href="#fig-ar2">Figure&nbsp;<span>4.5</span></a> (only the coefficient <span class="math inline">\(\phi_1\)</span> changed from the previous specification): <span id="eq-ar2"><span class="math display">\[
X_t = \phi_1 X_{t-1} + \epsilon_t;\; \epsilon_t \sim N(0,\sigma^2);\; \phi_1=-0.6,\; \sigma = 1.
\tag{4.7}\]</span></span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical ACF, PACF</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.6</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>RHO <span class="ot">&lt;-</span> phi<span class="sc">^</span>Lag</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, phi, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(Lag) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ar =</span> phi), <span class="at">n =</span> T)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">ACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> ACF)) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical ACF"</span>) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">PACF =</span> ALPHA), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical PACF"</span>) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(X) <span class="sc">+</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X) <span class="sc">+</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_spacer</span>() <span class="sc">+</span> p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ar2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-ar2-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.5: AR(1) process as specified in <a href="#eq-ar2">Equation&nbsp;<span>4.7</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>ACF of the AR(1) model takes two graphical forms depending on whether the coefficient <span class="math inline">\(\phi_{1}\)</span> is positive or negative. In the first case, the decay occurs through the positive axis only (<a href="#fig-ar1">Figure&nbsp;<span>4.4</span></a>). In the second case, the decay alternates between the negative and positive axes (<a href="#fig-ar2">Figure&nbsp;<span>4.5</span></a>). This is so-called <em>mixed exponential decay</em>. Although both forms are examples of exponential decay, they appear different visually.</p>
<p>As the order <span class="math inline">\(p\)</span> of an AR(<span class="math inline">\(p\)</span>) model increases, the number of different visual presentations of the ACF increases as well. The ACF of an AR(<span class="math inline">\(p\)</span>) model can take <span class="math inline">\(2^{p}\)</span> different graphical forms, depending on the signs (positive or negative) of the parameters <span class="math inline">\(\phi_{1}, \phi_{2}, \dots, \phi_{p}\)</span>. Thus, the ACF of an AR(2) model can take <span class="math inline">\(2^{2} = 4\)</span> different graphical forms.</p>
</section>
<section id="the-yulewold-representation-and-linear-processes" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="the-yulewold-representation-and-linear-processes"><span class="header-section-number">4.3</span> The Yule–Wold representation and linear processes</h2>
<p>A process <span class="math inline">\(X_{t}\)</span>, (<span class="math inline">\(t = 0, \pm 1, \pm 2, \dots\)</span>) is said to be linear if it has a representation of the form <span class="math display">\[
X_{t} = \mu + \sum^{\infty}_{r = - \infty} c_{r} \epsilon_{t - r},
\]</span> where</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is a common mean,</li>
<li><span class="math inline">\(c_{r}\)</span> is a sequence of fixed constants,</li>
<li><span class="math inline">\(\epsilon_{t}\)</span> are uncorrelated random variables with mean 0 and common variance.</li>
</ul>
<p>We assume <span class="math inline">\(\sum c^{2}_{r} &lt; \infty\)</span> to ensure that the variances of the individual <span class="math inline">\(X_{t}\)</span> are finite (stationarity and existence condition). Then the process <span class="math inline">\(X_{t}\)</span> is necessarily (weakly) stationary.</p>
<p>If we also require that <span class="math inline">\(\epsilon_{t}\)</span> are identically distributed, then <span class="math inline">\(X_{t}\)</span> is strictly stationary. For example, see the case of normally distributed <span class="math inline">\(\epsilon_{t}\)</span>.</p>
<p>If <span class="math inline">\(c_r = 0\)</span> for all <span class="math inline">\(r &lt; 0\)</span>, <span class="math inline">\(X_t\)</span> is called <em>causal</em> (i.e., the process at the time <span class="math inline">\(t\)</span> does not depend on the future, yet unobserved, values of <span class="math inline">\(\epsilon_{t}\)</span>).</p>
<p>The representation of a causal stationary process <span class="math inline">\(X_{t}\)</span> with zero mean in the form <span id="eq-YuleWald"><span class="math display">\[
X_{t} = \sum^{\infty}_{r = 0}  c_{r} \epsilon_{t - r},
\tag{4.8}\]</span></span> where <span class="math inline">\(\epsilon_{t} \sim \mathrm{WN}(0, \sigma^{2}\)</span>) and <span class="math inline">\(\sum c^{2}_{r} &lt; \infty\)</span>, is sometimes called <em>the Yule–Wald representation</em>.</p>
</section>
<section id="moving-average-ma-models" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="moving-average-ma-models"><span class="header-section-number">4.4</span> Moving average (MA) models</h2>
<p><strong>MA(1) model</strong></p>
<p>A zero mean stationary process <span class="math inline">\(Y_{t}\)</span> is called a moving average process of order 1, or <em>an MA(1) model</em>, if <span class="math inline">\(Y_{t}\)</span> satisfies <span class="math display">\[
Y_{t} = \epsilon_{t} + \theta_{1}  \epsilon_{t - 1},
\]</span> where <span class="math inline">\(\epsilon_{t}\)</span> is white noise.</p>
<p>In other words, an MA(1) process has <span class="math inline">\(c_{r} = 0\)</span> for every <span class="math inline">\(r &gt; 1\)</span> in its Yule–Wold representation <a href="#eq-YuleWald">Equation&nbsp;<span>4.8</span></a>.</p>
<p>The MA(1) model may be rewritten as <span class="math display">\[
Y_{t} = (1 + \theta_{1} B) \epsilon_{t},
\]</span> or in the compact form <span class="math display">\[
Y_t = \theta (B) \epsilon_t,
\]</span> where <span class="math inline">\(\theta (\lambda)\)</span> is the polynomial <span class="math inline">\(\theta(\lambda) = 1 + \theta_{1} \lambda\)</span>.</p>
<p><strong>MA(q) model</strong></p>
<p>We can extend MA(1) model further and consider <span class="math display">\[
\begin{split}
Y_{t} &amp;= \epsilon_{t} + \theta_{1} \epsilon_{t -1} + \theta_{2} \epsilon_{t - 2} + \dots + \theta_{q} \epsilon_{t - q} \\
&amp;= \epsilon_{t} + \sum_{i=1}^q \theta_i \epsilon_{t-i}.
\end{split}
\]</span> This model is called a <em>moving average model of order <span class="math inline">\(q\)</span></em>, or a MA(<span class="math inline">\(q\)</span>).</p>
<p>We can write down MA(<span class="math inline">\(q\)</span>) as <span class="math display">\[
Y_{t} = \left(1 + \theta_{1} B + \theta_{2} B^{2} + \dots + \theta_{q} B^{q} \right) \epsilon_{t} ,
\]</span> or in the compact form <span class="math display">\[
Y_t = \theta (B) \epsilon_t,
\]</span> where <span class="math inline">\(\theta(\lambda)\)</span> is the polynomial <span class="math inline">\(\theta(\lambda) = 1 + \theta_{1} \lambda + \theta_{2} \lambda^{2} + \dots + \theta_{q} \lambda^{q}\)</span>.</p>
<p>Now compute the ACVF and ACF of the MA(<span class="math inline">\(q\)</span>) process <span class="math inline">\(Y_{t}\)</span>. Using the Yule–Wald representation of <span class="math inline">\(Y_{t}\)</span>, <span class="math display">\[
Y_{t} = \sum^{q}_{r = 0} \theta_{r} \epsilon_{t - r},
\]</span> the autocovariance <span class="math display">\[
\begin{split}
\gamma_Y(h) &amp; = \mathrm{cov}(Y_{t}, Y_{t+h}) = \mathrm{cov} \left( \sum^{q}_{r = 0} \theta_{r }\epsilon_{t - r}, \sum^{q}_{\ell = 0} \theta_{\ell} \epsilon_{t + h - \ell} \right) \\
\\
&amp; =  \sum^{q}_{r = 0} \sum^{q}_{\ell = 0} \mathrm{cov} \left( \theta_{r } \epsilon_{t - r},  \theta_{\ell} \epsilon_{t + h - \ell} \right) \\
\\
&amp; =   \sum^{q}_{r = 0}   \sum^{q}_{\ell = 0} \theta_{r } \theta_{\ell} \mathrm{cov}  \left( \epsilon_{t - r}, \epsilon_{t - r}  \right) ~~ \text{since cov} \left( \epsilon_{u}, \epsilon_{v}  \right) = 0 ~ \text{unless} ~ u = v \\
\\
&amp; =  \sigma_{\epsilon}^{2} \sum^{q}_{r = 0} \theta_{r} \theta_{r+h}.
\end{split}
\]</span> Note that the case of no time shift between the noise series, i.e., when <span class="math inline">\(t-r = t+h-l\)</span>, leads to <span class="math inline">\(l=r+h\)</span>, which is used in the last row.</p>
<p>Hence, <span id="eq-MAacvf"><span class="math display">\[
\gamma_Y(h) = \left\{
\begin{array}{lcl}
\sigma_{\epsilon}^{2} \sum^{q  - h}_{r = 0} \theta_{r} \theta_{r+h} &amp; \text{for} &amp;  h \leqslant q;\\
0 &amp; \text{for} &amp; h &gt; q.
\end{array}
\right.
\tag{4.9}\]</span></span></p>
<p>This leads us to the most important result about the correlation structure for MA(<span class="math inline">\(q\)</span>) processes. For an MA(<span class="math inline">\(q\)</span>) process, <span class="math inline">\(\gamma(h) = 0\)</span> for all <span class="math inline">\(h &gt; q\)</span>. Equivalently, the ACF has <span class="math inline">\(q\)</span> ‘starting’ correlations or spikes, <span class="math inline">\(\rho(1), \rho(2), \dots, \rho(q)\)</span>, and then <span class="math inline">\(\rho(h) = 0\)</span> for <span class="math inline">\(h &gt; q\)</span>. We say that the ACF ‘cuts off’ after the lag <span class="math inline">\(q\)</span>.</p>
<p>Now compute the actual values of the starting correlations <span class="math inline">\(\rho(1), \dots, \rho(q)\)</span> in terms of the parameters <span class="math inline">\(\theta_{0} = 1, \theta_{1}, \theta_{2}, \dots, \theta_{q}\)</span>. Using <a href="#eq-MAacvf">Equation&nbsp;<span>4.9</span></a>, we get</p>
<ul>
<li><p>For the MA(1) model <span class="math inline">\(q = 1\)</span>. Hence <span class="math display">\[
\begin{split}
h  =  0 &amp;\rightarrow \gamma(0) = \sigma^{2} \sum^{1}_{ r=0}  \theta^{2}_{r} = \sigma^{2} \left( \theta^{2}_{0} + \theta^{2}_{1} \right) = \sigma^{2} \left(1 + \theta^{2}_{1}\right). \\
\\
h  =  1 &amp;\rightarrow \gamma(1) = \sigma^{2}  \sum^{0}_{ r=0}  \theta_{r} \theta_{r + 1} = \sigma^{2} \theta_{0} \theta_{1} = \sigma^{2} \theta_{1}.
\end{split}
\]</span></p>
<p>Therefore <span class="math inline">\(\rho(1) = \gamma(1) / \gamma(0) = \theta_{1} / (1 + \theta^{2}_{1})\)</span>.</p></li>
<li><p>For the MA(2) model <span class="math inline">\(q = 2\)</span>. Hence <span class="math display">\[
\begin{split}
h =  0 &amp;\rightarrow \gamma(0) = \sigma^{2} \sum^{2}_{r=0}  \theta^{2}_{r} = \sigma^{2} \left(1 + \theta^{2}_{1} + \theta^{2}_{2}\right). \\
\\
h  =  1 &amp;\rightarrow \gamma(1) = \sigma^{2} \sum^{1}_{r=0}  \theta_{r} \theta_{r + 1} = \sigma^{2} \left(\theta_{1} + \theta_{1} \theta_{2} \right) = \sigma^{2} \theta_{1}  \left(1 + \theta_{2}\right). \\
\\
h  =  2 &amp;\rightarrow \gamma(2) = \sigma^{2} \sum^{0}_{r=0}  \theta_{r} \theta_{r + 2} = \sigma^{2} \theta_{2}.
\end{split}
\]</span> Therefore <span class="math inline">\(\rho(1) = \frac{\gamma(1)}{\gamma(0)} = \frac{\theta_{1} \left(1 + \theta_{2} \right)}{1+ \theta^{2}_{1} + \theta^{2}_{2}}\)</span> and <span class="math inline">\(\rho(2) = \frac{\gamma(2)}{\gamma(0)} = \frac{\theta_{2}}{1+ \theta^{2}_{1} + \theta^{2}_{2}}\)</span>.</p></li>
<li><p>Proceed analogously for the MA(<span class="math inline">\(q\)</span>) model.</p></li>
</ul>
<p>Another method of obtaining the correlation coefficients of the MA(<span class="math inline">\(q\)</span>) is to derive the covariance <span class="math inline">\(\gamma(h) = \mathrm{cov} (Y_{t}, Y_{t - h} )\)</span> directly by using the bilinear properties of covariance and determining the interaction between the white noise terms. The advantage of this method is that we do not have to memorize anything. Moreover, since white noise has the property that <span class="math inline">\(\mathrm{cov} (\epsilon_{u}, \epsilon_{v}) = 0\)</span> whenever <span class="math inline">\(u \neq v\)</span>, interactions occur only when the time indices match up, i.e., only when <span class="math inline">\(u = v\)</span>.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Calculate ACF of MA(<span class="math inline">\(q\)</span>)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider an MA(1) model. Let <span class="math inline">\(h \geqslant 0\)</span>. Applying the covariance properties we obtain the general expression: <span class="math display">\[
\begin{split}
\gamma(h) &amp; =  \mathrm{cov}\left( Y_{t}, Y_{t - h} \right) =  \mathrm{cov} \left( \epsilon_{t} + \theta_{1} \epsilon_{t - 1}, \epsilon_{t - h} + \theta_{1} \epsilon_{t - h - 1}  \right) \\
&amp; =  \mathrm{cov} \left( \epsilon_{t},  \epsilon_{t - h} \right) + \theta_{1} \mathrm{cov} \left(  \epsilon_{t},  \epsilon_{t - h - 1}  \right) + \theta_{1} \mathrm{cov} \left( \epsilon_{t - 1}, \epsilon_{t - h} \right) + \theta^{2}_{1} \mathrm{cov} \left(\epsilon_{t - 1}, \epsilon_{t - h - 1} \right).
\end{split}
\]</span></p>
<p>Note that the covariances in the last line of the above expression will be nonzero if the time indices match up. Plugging different values of <span class="math inline">\(h\)</span> into the above equation we obtain <span class="math display">\[
\begin{split}
h  =  0 &amp;\rightarrow \gamma(0) =   \mathrm{cov} \left( \epsilon_{t},   \epsilon_{t} \right)  + 0 + 0 + \theta^{2}_{1}  \mathrm{cov} \left( \epsilon_{t - 1},  \epsilon_{t - 1}  \right) = \sigma^{2} + \theta^{2}_{1} \sigma^{2} = \sigma^{2} \left( 1 + \theta^{2}_{1} \right). \\
\\
h  =  1 &amp;\rightarrow \gamma(1) = 0 + 0 + \theta_{1}  \mathrm{cov} \left( \epsilon_{t - 1},  \epsilon_{t - 1}  \right) + 0 = \sigma^{2} \theta_{1}.\\
\\
h \geqslant 2 &amp;\rightarrow \gamma(h) = 0 + 0 + 0 + 0 = 0.
\end{split}
\]</span></p>
<p>This method generalizes easily to computing covariances for MA(<span class="math inline">\(q\)</span>) models of higher order.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have explicitly determined the structure of the ACF of an MA(<span class="math inline">\(q\)</span>) process. Its most important feature is that <span class="math inline">\(\rho(h) = 0\)</span> for <span class="math inline">\(h &gt; q\)</span>. Remember this about MA processes.</p>
</div>
</div>
<p>Finer features, such as expressing the <span class="math inline">\(\rho(h)\)</span> in terms of the <span class="math inline">\(\theta_{r}\)</span> coefficients, can be determined as above.</p>
<p><strong>PACF of MA processes</strong></p>
<p>For an MA(<span class="math inline">\(q\)</span>), we can write <span class="math inline">\(Y_t = -\sum_{j=1}^{\infty} \pi_j Y_{t-j} + \epsilon_t\)</span>. Moreover, no finite representation exists. From this result, it should be apparent that the PACF will never cut off, as in the case of an AR(<span class="math inline">\(p\)</span>). For an MA(1), <span class="math inline">\(Y_t = \epsilon_t +\theta \epsilon_{t-1}\)</span>, with <span class="math inline">\(|\theta| &lt; 1\)</span>, it can be shown that <span class="citation" data-cites="Shumway:Stoffer:2014">(<a href="references.html#ref-Shumway:Stoffer:2014" role="doc-biblioref">Shumway and Stoffer 2014</a>)</span>: <span class="math display">\[
\rho_{hh} = - \frac{(-\theta)^h (1 - \theta^2)}{1 - \theta^{2(h+1)}}, \; h \geqslant 1.
\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every MA(<span class="math inline">\(q\)</span>) process has an infinite autoregressive expansion and its PACF never cuts off. In fact, it can be shown that the PACF of an MA(<span class="math inline">\(q\)</span>) process damps out according to a mixed exponential decay of order <span class="math inline">\(q\)</span>.</p>
</div>
</div>
<p>We do not have to compute the PACF by performing numerous regressions first. The computations are done via a recursive formula.</p>
<p>Similar to AR(1) examples above, now consider two sets of plots for MA(1) processes with a positive and negative coefficient. For the MA(1) process <span id="eq-ma1"><span class="math display">\[
X_t = \theta_1 \epsilon_{t-1} + \epsilon_t;\; \epsilon_t \sim N(0,\sigma^2);\; \theta_1=0.3,\; \sigma = 1,
\tag{4.10}\]</span></span> see plots in <a href="#fig-ma1">Figure&nbsp;<span>4.6</span></a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical ACF, PACF</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>RHO <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, theta<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> theta<span class="sc">^</span><span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(Lag) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">ARMAacf</span>(<span class="at">ma =</span> theta, <span class="at">lag.max =</span> <span class="fu">max</span>(Lag), <span class="at">pacf =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ma =</span> theta), <span class="at">n =</span> T)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">ACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> ACF)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical ACF"</span>) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">PACF =</span> ALPHA), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical PACF"</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(X) <span class="sc">+</span> </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X) <span class="sc">+</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_spacer</span>() <span class="sc">+</span> p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5) <span class="sc">+</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ma1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-ma1-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.6: MA(1) as specified in <a href="#eq-ma1">Equation&nbsp;<span>4.10</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>For the MA(1) process with negative <span class="math inline">\(\theta_1\)</span>, <span id="eq-ma2"><span class="math display">\[
X_t = \theta_1 \epsilon_{t-1} + \epsilon_t;\; \epsilon_t \sim N(0,\sigma^2);\; \theta_1=-0.3,\; \sigma = 1,
\tag{4.11}\]</span></span> see plots in <a href="#fig-ma2">Figure&nbsp;<span>4.7</span></a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Theoretical ACF, PACF</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.3</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>RHO <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, theta<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> theta<span class="sc">^</span><span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(Lag) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">ARMAacf</span>(<span class="at">ma =</span> theta, <span class="at">lag.max =</span> <span class="fu">max</span>(Lag), <span class="at">pacf =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">ma =</span> theta), <span class="at">n =</span> T)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">ACF =</span> RHO), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> ACF)) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical ACF"</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(Lag, <span class="at">PACF =</span> ALPHA), <span class="fu">aes</span>(<span class="at">x =</span> Lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Theoretical PACF"</span>) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">autoplot</span>(X) <span class="sc">+</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample time series"</span>) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X) <span class="sc">+</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample ACF"</span>) <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(X, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span> </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Sample PACF"</span>) <span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_spacer</span>() <span class="sc">+</span> p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ma2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-ma2-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.7: MA(1) as specified in <a href="#eq-ma2">Equation&nbsp;<span>4.11</span></a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="arma" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="arma"><span class="header-section-number">4.5</span> ARMA</h2>
<p>An ARMA(<span class="math inline">\(p, q\)</span>) is a mixture of <span class="math inline">\(p\)</span> autoregressive components and <span class="math inline">\(q\)</span> moving average components. It can be expressed as <span class="math display">\[
\phi^{p} (B)Y_{t} = \theta^{q} (B) \epsilon_{t},
\]</span> where <span class="math inline">\(\epsilon_{t}\)</span> is white noise, <span class="math inline">\(\phi^{p}(\lambda)\)</span> and <span class="math inline">\(\theta^{q}(\lambda)\)</span> are the polynomials of degree <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>, respectively.</p>
<p><strong>ARMA(1,2)</strong></p>
<p>Short notation <span class="math inline">\(\phi^{1} (B)Y_{t} = \theta^{2} (B) \epsilon_{t}\)</span> expands to <span class="math display">\[
\left(1 - \phi_{1} B \right) Y_{t} = \left( 1 + \theta_{1} B + \theta_{2} B^{2} \right) \epsilon_{t}
\]</span> and gives <span class="math display">\[
Y_{t} - \phi_{1} Y_{t - 1} = \epsilon_{t} + \theta_{1} \epsilon_{t - 1} + \theta_{2}\epsilon_{t - 2}.
\]</span></p>
<p>Isolate <span class="math inline">\(Y_{t}\)</span> on the left side of the equation to get the final form of the expansion <span class="math display">\[
Y_{t} = \phi_{1} Y_{t -1} + \epsilon_{t} + \theta_{ 1} \epsilon_{t - 1} + \theta_{2} \epsilon_{t-2}.
\]</span></p>
<p><strong>ARMA(3,1)</strong></p>
<p>Short notation <span class="math inline">\(\phi^{3} (B)Y_{t} = \theta^{1} (B) \epsilon_{t}\)</span> expands to <span class="math display">\[
\left( 1 -  \phi_{1} B - \phi_{2} B^{2}  - \phi_{3} B^{3} \right) Y_{t} = \left( 1 + \theta_{1} B \right) \epsilon_{t}
\]</span> or <span class="math display">\[
Y_{t} - \phi_{1} Y_{t - 1} - \phi_{2} Y_{t - 2} - \phi_{3} Y_{t - 3} = \epsilon_{t} + \theta_{1} \epsilon_{t-1}.
\]</span></p>
<p>Isolating <span class="math inline">\(Y_{t}\)</span> gives the final form <span class="math display">\[
Y_{t} = \phi_{1} Y_{t - 1} + \phi_{2} Y_{t - 2} + \phi_{3} Y_{t - 3} + \epsilon_{t} + \theta_{1} \epsilon_{t-1}.
\]</span></p>
<p>In a mixed ARMA(<span class="math inline">\(p, q\)</span>) process (that is, <span class="math inline">\(p &gt; 0\)</span>, <span class="math inline">\(q &gt; 0\)</span>), neither the ACF nor the PACF cuts off abruptly. Both the ACF and PACF exhibit mixed exponential decay. This occurs because the AR component introduces mixed exponential decay into the ACF, while the MA component introduces mixed exponential decay into the PACF.</p>
</section>
<section id="summary-of-armaarma-models" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="summary-of-armaarma-models"><span class="header-section-number">4.6</span> Summary of AR/MA/ARMA models</h2>
<p>Use the following summary or <a href="#tbl-arma">Table&nbsp;<span>4.1</span></a> to decide on the appropriate model specifications.</p>
<p>AR(<span class="math inline">\(p\)</span>) models: <span class="math inline">\(\phi^{p} (B)Y_{t} = \epsilon_{t}\)</span></p>
<ul>
<li>ACF: <span class="math inline">\(p\)</span> initial spikes, then damps out as a mixed exponential decay of order <span class="math inline">\(p\)</span> (never 0)</li>
<li>PACF: <span class="math inline">\(p\)</span> initial spikes, then cuts off; PACF(<span class="math inline">\(h\)</span>) = 0 for <span class="math inline">\(h &gt; p\)</span></li>
</ul>
<p>MA(<span class="math inline">\(q\)</span>) models: <span class="math inline">\(Y_{t} = \theta^{q} (B) \epsilon_{t}\)</span></p>
<ul>
<li>ACF: <span class="math inline">\(q\)</span> initial spikes, then cuts off; ACF(<span class="math inline">\(h\)</span>) = 0 for <span class="math inline">\(h &gt; q\)</span></li>
<li>PACF: <span class="math inline">\(q\)</span> initial spikes, then damps out as a mixed exponential decay of order <span class="math inline">\(q\)</span> (never 0)</li>
</ul>
<p>ARMA(<span class="math inline">\(p,q\)</span>) models (<span class="math inline">\(p&gt;0\)</span>, <span class="math inline">\(q&gt;0\)</span>): <span class="math inline">\(\phi^{p} (B)Y_{t} = \theta^{q} (B) \epsilon_{t}\)</span></p>
<ul>
<li>ACF: has max (<span class="math inline">\(p, q\)</span>) initial spikes, then damps out as a mixed exponential decay driven by the AR(<span class="math inline">\(p\)</span>) component (never 0)</li>
<li>PACF: has max(<span class="math inline">\(p, q\)</span>) initial spikes, then damps out as a mixed exponential decay driven by the MA(<span class="math inline">\(q\)</span>) component (never 0)</li>
</ul>
<div id="tbl-arma" class="anchored">
<table class="table">
<caption>Table&nbsp;4.1: Summary of ARMA(<span class="math inline">\(p, q\)</span>) models</caption>
<thead>
<tr class="header">
<th>Model</th>
<th>ACF</th>
<th>PACF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MA(<span class="math inline">\(q\)</span>)</td>
<td>Zero after lag <span class="math inline">\(q\)</span></td>
<td>Exponential decay</td>
</tr>
<tr class="even">
<td>AR(<span class="math inline">\(p\)</span>)</td>
<td>Exponential decay</td>
<td>Zero after lag <span class="math inline">\(p\)</span></td>
</tr>
<tr class="odd">
<td>ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>)</td>
<td>Mixed exponential decay</td>
<td>Mixed exponential decay</td>
</tr>
</tbody>
</table>
</div>
<p>In practice, the final selection of ARMA’s orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> (i.e., model specification) is often based on</p>
<ul>
<li>information criterion such as AIC or BIC or</li>
<li>forecast accuracy (e.g., PRMSE and PMAE of point forecasts for a testing set)</li>
</ul>
</section>
<section id="example-analysis" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="example-analysis"><span class="header-section-number">4.7</span> Example analysis</h2>
<div class="cell">

</div>
<p>Suppose we are given a univariate time series <span class="math inline">\(Y_t\)</span>.</p>
<p>First, plot the data (<a href="#fig-simYt">Figure&nbsp;<span>4.8</span></a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(Y) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-simYt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-simYt-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.8: Plot of the time series <span class="math inline">\(Y_t\)</span>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>If no obvious trend, plot sample ACF and PACF (<a href="#fig-simYtacf">Figure&nbsp;<span>4.9</span></a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(Y) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(Y, <span class="at">type =</span> <span class="st">"partial"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-simYtacf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-simYtacf-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.9: Estimated ACF and PACF of <span class="math inline">\(Y_t\)</span>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Based on the plots (<a href="#fig-simYtacf">Figure&nbsp;<span>4.9</span></a>), <em>ACF decays faster than linearly</em> (some indication of stationarity), and <em>PACF is non-zero up to lag 2</em> (cuts off after lag 2). Knowing the expected behavior of ACF and PACF for ARMA models (see <a href="#tbl-arma">Table&nbsp;<span>4.1</span></a>), AR(2) can be suggested in this case, which is equivalent to ARMA(2,0).</p>
<p>Given the potential sample variability affecting the estimates of ACF and PACF, there could be other model specifications close to the selected one that may perform similarly or even slightly better when compared to the one selected based on the visual analysis. For example, we can check other suitable combinations within the maximal lag of 2 we identified: ARMA(1,0), (2,0), (0,1), (1,1), (2,1), (0,2), (1,2), and ARMA(2,2). With so many choices, we need some quantitative criteria to select the best model.</p>
<p>The code below uses a ‘manual’ approach of calculating Akaike and Bayesian information criteria (AIC and BIC) to select the model from the specified set, but see the next section for R functions that do it more automatically.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinations of p and q, without p = q = 0</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">p =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">q =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>))[<span class="sc">-</span><span class="dv">1</span>, ] </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(results)) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">arima</span>(Y, <span class="at">order =</span> <span class="fu">c</span>(results<span class="sc">$</span>p[i], <span class="dv">0</span>, results<span class="sc">$</span>q[i]))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>aic[i] <span class="ot">&lt;-</span> mod<span class="sc">$</span>aic</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    results<span class="sc">$</span>bic[i] <span class="ot">&lt;-</span> <span class="fu">BIC</span>(mod)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt;   p q aic bic
#&gt; 2 1 0 851 862
#&gt; 3 2 0 838 853
#&gt; 4 0 1 987 998
#&gt; 5 1 1 839 854
#&gt; 6 2 1 840 859
#&gt; 7 0 2 915 929
#&gt; 8 1 2 841 859
#&gt; 9 2 2 842 864</code></pre>
</div>
</div>
<section id="automatic-model-selection" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="automatic-model-selection"><span class="header-section-number">4.7.1</span> Automatic model selection</h3>
<p>For example, the function <code>stats::ar()</code> by default uses the Yule–Walker method to estimate the coefficients and AIC to select the best order for AR(<span class="math inline">\(p\)</span>) model, where the maximum of <span class="math inline">\(p\)</span> can be set by the user.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ar</span>(Y, <span class="at">order.max =</span> <span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; 
#&gt; Call:
#&gt; ar(x = Y, order.max = 11)
#&gt; 
#&gt; Coefficients:
#&gt;     1      2  
#&gt; 0.612  0.220  
#&gt; 
#&gt; Order selected 2  sigma^2 estimated as  0.939</code></pre>
</div>
</div>
<p>The function <code>funtimes::ARest()</code> is a wrapper for <code>stats::ar()</code>. It adds a difference-based estimator by <span class="citation" data-cites="Hall:VanKeilegom:2003">Hall and Van Keilegom (<a href="references.html#ref-Hall:VanKeilegom:2003" role="doc-biblioref">2003</a>)</span>, which is now used by default, and also switches to BIC as the model selection criterion. The selection is still done only for the order <span class="math inline">\(p\)</span> in AR(<span class="math inline">\(p\)</span>), without considering the possibility of MA terms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order selection with BIC and estimation with HVK</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>funtimes<span class="sc">::</span><span class="fu">ARest</span>(Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.571 0.176</code></pre>
</div>
</div>
<p>To check the correspondence with <code>stats::ar()</code>, change the method and fix the <code>ar.order</code> (turn off its automatic selection):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>funtimes<span class="sc">::</span><span class="fu">ARest</span>(Y, <span class="at">ar.method =</span> <span class="st">"yw"</span>, <span class="at">ar.order =</span> <span class="dv">2</span>, <span class="at">BIC =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; [1] 0.612 0.220</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>BIC selects more parsimonious models than AIC does. Such simpler models are usually preferred for forecasting tasks.</p>
</div>
</div>
<p>The function <code>fable::ARIMA()</code> searches over possible ARMA models within some order constraints (the default maximal orders and search strategy are different from the two functions above – see help files for each function in R). This function is a successor of the function <code>forecast::auto.arima()</code> and is probably the most comprehensive R function for estimating and selecting ARMA models. It allows to fit and select not only ARMA(<span class="math inline">\(p,q\)</span>) models, but also more complex models that will be described later in the course.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fable)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as_tsibble</span>(Y) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(<span class="fu">ARIMA</span>(Y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">ic =</span> <span class="st">"bic"</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#&gt; Series: Y 
#&gt; Model: ARIMA(2,0,0) w/ mean 
#&gt; 
#&gt; Coefficients:
#&gt;          ar1     ar2  constant
#&gt;       0.6100  0.2184    0.0466
#&gt; s.e.  0.0562  0.0562    0.0545
#&gt; 
#&gt; sigma^2 estimated as 0.9383:  log likelihood=-415
#&gt; AIC=838   AICc=838   BIC=853</code></pre>
</div>
</div>
<p>In all considered cases the model ARMA(2,0), which is equivalent to AR(2), was selected. Our next step is the residual diagnostics – check the residuals for homoskedasticity, uncorrelatedness, and normality (<a href="#fig-resfable">Figure&nbsp;<span>4.10</span></a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>feasts<span class="sc">::</span><span class="fu">gg_tsresiduals</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-resfable" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-resfable-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.10: Residual diagnostics for the ARMA(2,0) model estimated using the package <code>fable</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Based on the plots, the residuals do not violate the assumptions, so proceed with forecasting (<a href="#fig-fcstfable">Figure&nbsp;<span>4.11</span></a>).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>m <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    fabletools<span class="sc">::</span><span class="fu">forecast</span>(<span class="at">h =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autoplot</span>(Y) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fcstfable" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-fcstfable-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.11: Predictions 10 steps ahead from the ARMA(2,0) model estimated using the package <code>fable</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>However, the syntax and outputs of the package <code>fable</code> are quite different from typical R alternatives. See <a href="#fig-res">Figure&nbsp;<span>4.12</span></a> with results still plotted using the package <code>ggplot2</code>, but obtained using the base-R functions. Also, see the base-R function <code>tsdiag()</code> for residual diagnostics.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">arima</span>(Y, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> m<span class="sc">$</span>residuals</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(e) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">ggAcf</span>(e) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggqqplot</span>(e) <span class="sc">+</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Standard normal quantiles"</span>) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(m, <span class="at">h =</span> <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> (p2 <span class="sc">+</span> p3) <span class="sc">/</span> p4 <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">'A'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-res" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-res-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.12: Residual diagnostics and predictions 10 steps ahead from the ARMA(2,0) model estimated using the base-R function <code>stats::arima()</code>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Using the estimated residuals, <span class="math inline">\(\hat{\epsilon}_t = Y_t - \hat{Y}_t\)</span>, we can get the ‘fitted’ values, <span class="math inline">\(\hat{Y}_t\)</span> (technically, these are one-step-ahead predictions), see <a href="#fig-simYtfit">Figure&nbsp;<span>4.13</span></a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Fit <span class="ot">&lt;-</span> Y <span class="sc">-</span> e</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">autoplot</span>(Y) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autolayer</span>(Fit) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Y"</span>) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-simYtfit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="l04_arma_files/figure-html/fig-simYtfit-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.13: Oberved time series (black) and one-step-ahead predictions (red) from the ARMA(2,0) model.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">4.8</span> Conclusion</h2>
<p>We defined AR, MA, and ARMA models and showed that time series processes corresponding to such models satisfy the conditions of weak stationarity.</p>
<p>Using ACF and PACF plots, we can select the orders <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> to specify an ARMA model, but we also can use a variety of functions running different evaluations and tests for competitive models.</p>
<p>We face the choice of different methods to estimate (i.e., estimators) and methods to compare models.</p>
<p>The most often used estimators for ARMA models are</p>
<ul>
<li>maximum likelihood,</li>
<li>Yule–Walker, and</li>
<li>Burg.</li>
</ul>
<p>The OLS-based estimator is used less frequently.</p>
<p>Methods to compare competing models may involve</p>
<ul>
<li>log-likelihood, MAE, RMSE, and information criteria to assess in-sample (training) goodness-of-fit;</li>
<li>diagnostics checks of residuals (discard models if their residuals do not pass the tests);</li>
<li>comparisons of models on a testing set (PMAE, PRMSE, coverage, and width of prediction intervals).</li>
</ul>
<p>For each of these options, there are multiple R functions available, or can be written from scratch.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-Brockwell:Davis:2002" class="csl-entry" role="doc-biblioentry">
Brockwell PJ, Davis RA (2002) Introduction to time series and forecasting, 2nd edn. Springer, New York
</div>
<div id="ref-Hall:VanKeilegom:2003" class="csl-entry" role="doc-biblioentry">
Hall P, Van Keilegom I (2003) Using difference-based methods for inference in nonparametric regression with time series errors. Journal of the Royal Statistical Society: Series B (Statistical Methodology) 65:443–456. <a href="https://doi.org/10.1111/1467-9868.00395">https://doi.org/10.1111/1467-9868.00395</a>
</div>
<div id="ref-Shumway:Stoffer:2014" class="csl-entry" role="doc-biblioentry">
Shumway RH, Stoffer DS (2014) Time series analysis and its applications with <span>R</span> examples, 3-EZ. Free Texts in Statistics
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./l03_smoothing.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Smoothing, Detrending, and Deseasonalizing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./l05_arima.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Autoregressive Integrated Moving Average (ARIMA) Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>